# ğŸ“– ê²€ì¦2 - Bean Validation
<br/><br/>
# ğŸ” Bean Validation - ì†Œê°œ
ê²€ì¦ ê¸°ëŠ¥ì„ ë§¤ë²ˆ ì½”ë“œë¡œ ì‘ì„±í•˜ëŠ” ê²ƒì€ ìƒë‹¹íˆ ë²ˆê±°ë¡­ë‹¤.<br/>
ì´ëŸ° ê²€ì¦ ë¡œì§ì„ ëª¨ë“  í”„ë¡œì íŠ¸ì— ì ìš©í•  ìˆ˜ ìˆê²Œ ê³µí†µí™”í•˜ê³ , í‘œì¤€í™”í•œ ê²ƒì´ ë°”ë¡œ **Bean Validation**ì´ë‹¤.<br/>
**Bean Validation**ì„ ì˜ í™œìš©í•˜ë©´, ì• ë…¸í…Œì´ì…˜ í•˜ë‚˜ë¡œ ê²€ì¦ ë¡œì§ì„ ë§¤ìš° í¸ë¦¬í•˜ê²Œ ì ìš©í•  ìˆ˜ ìˆë‹¤.<br/><br/>
### Bean Validation
**Bean Validation**ì€ íŠ¹ì •í•œ êµ¬í˜„ì²´ê°€ ì•„ë‹ˆë¼ Bean Validation 2.0(JSR-380)ì´ë¼ëŠ” ê¸°ìˆ  í‘œì¤€ì´ë‹¤.<br/>
ì‰½ê²Œ ì´ì•¼ê¸°í•´ì„œ ê²€ì¦ ì• ë…¸í…Œì´ì…˜ê³¼ ì—¬ëŸ¬ ì¸í„°í˜ì´ìŠ¤ì˜ ëª¨ìŒì´ë‹¤.<br/><br/>
Bean Validationì„ êµ¬í˜„í•œ ê¸°ìˆ ì¤‘ì— ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” êµ¬í˜„ì²´ëŠ” í•˜ì´ë²„ë„¤ì´íŠ¸ Validatorì´ë‹¤.<br/>
ì´ë¦„ì´ í•˜ì´ë²„ë„¤ì´íŠ¸ê°€ ë¶™ì–´ì„œ ê·¸ë ‡ì§€ ORMê³¼ëŠ” ê´€ë ¨ì´ ì—†ë‹¤.<br/><br/>
**í•˜ì´ë²„ë„¤ì´íŠ¸ Validator ê´€ë ¨ ë§í¬**
- ê³µì‹ ì‚¬ì´íŠ¸: https://hibernate.org/validator/
- ê³µì‹ ë©”ë‰´ì–¼: https://docs.jboss.org/hibernate/validator/6.2/reference/en-US/html_single/#validator-gettingstarted-createproject
- ê²€ì¦ ì• ë…¸í…Œì´ì…˜ ëª¨ìŒ: https://docs.jboss.org/hibernate/validator/6.2/reference/en-US/html_single/#section-builtin-constraints
<br/><br/>
# ğŸ” Bean Validation - ì‹œì‘
ë¨¼ì € ìŠ¤í”„ë§ê³¼ í†µí•©í•˜ì§€ ì•Šê³ , ìˆœìˆ˜í•œ Bean Validation ì‚¬ìš©ë²•ë¶€í„° í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ ì•Œì•„ë³´ì.<br/><br/>
### Bean Validation ì˜ì¡´ê´€ê³„ ì¶”ê°€
`build.gradle`
```
implementation 'org.springframework.boot:spring-boot-starter-validation'
```
**Jakarta Bean Validation**<br/>
`jakarta.validation-api`: Bean Validation ì¸í„°í˜ì´ìŠ¤<br/>
`hibernate-validator`: êµ¬í˜„ì²´<br/><br/>
### Bean Validation ì• ë…¸í…Œì´ì…˜ ì ìš©
`main/java/hello/itemservice/domain/item/Item`
```java
@Data
public class Item {

    private Long id;

    @NotBlank
    private String itemName;

    @NotNull
    @Range(min = 1000, max = 1000000)
    private Integer price;

    @NotNull
    @Max(9999)
    private Integer quantity;

    ...
```
**ê²€ì¦ ì• ë…¸í…Œì´ì…˜**
- `@NotBlank`: ë¹ˆê°’ + ê³µë°±ë§Œ ìˆëŠ” ê²½ìš°ë¥¼ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
- `@NotNull`: `null`ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
- `@Range(min = 1000, max = 1000000)`: ë²”ìœ„ ì•ˆì˜ ê°’ì´ì–´ì•¼ í•œë‹¤.
- `@Max(9999)`: ìµœëŒ€ 9999ê¹Œì§€ë§Œ í—ˆìš©í•œë‹¤.
<br/><br/>
### Bean Validation í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±
`test/java/hello/itemservice/validation/BeanValidationTest`
```java
    @Test
    void beanValidation() {
        ValidatorFactory factory = Validation.buildDefaultValidatorFactory();   //ê²€ì¦ê¸° ìƒì„±
        Validator validator = factory.getValidator();   //ê²€ì¦ ì‹¤í–‰

        Item item = new Item();
        item.setItemName(" "); //ê³µë°±
        item.setPrice(0);
        item.setQuantity(10000);

        Set<ConstraintViolation<Item>> violations = validator.validate(item);
        for (ConstraintViolation<Item> violation : violations) {
            System.out.println("violation = " + violation);
            System.out.println("violation = " + violation.getMessage());

        }
    }
```
ë¹ˆ ê²€ì¦ê¸°(Bean Validation)ë¥¼ ì§ì ‘ ì‚¬ìš©í•œë‹¤.<br/><br/>
`ConstraintViolation` ì¶œë ¥ ê²°ê³¼ë¥¼ ë³´ë©´, ê²€ì¦ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê°ì²´, í•„ë“œ, ë©”ì‹œì§€ ì •ë³´ ë“± ë‹¤ì–‘í•œ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/><br/>
# ğŸ” Bean Validation - ìŠ¤í”„ë§ ì ìš©
ê¸°ì¡´ì— ë“±ë¡í•œ `ItemValidator`ë¥¼ ì œê±°í•´ì„œ ì˜¤ë¥˜ ê²€ì¦ê¸°ê°€ ì¤‘ë³µ ì ìš©ë˜ì§€ ì•Šë„ë¡ í•œë‹¤.<br/><br/>
`main/java/hello/itemservice/web/validation/ValidationItemControllerV3`
```java
    @PostMapping("/add")
    public String addItem(@Validated @ModelAttribute Item item, BindingResult bindingResult, RedirectAttributes redirectAttributes) {

        //ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
        if (bindingResult.hasErrors()) {
            log.info("errors={}", bindingResult);
            return "validation/v3/addForm";
        }

        //ì„±ê³µ ë¡œì§
        Item savedItem = itemRepository.save(item);
        redirectAttributes.addAttribute("itemId", savedItem.getId());
        redirectAttributes.addAttribute("status", true);
        return "redirect:/validation/v3/items/{itemId}";
    }
```
ì‹¤í–‰í•´ë³´ë©´ ì• ë…¸í…Œì´ì…˜ ê¸°ë°˜ì˜ Bean Validationì´ ì •ìƒ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/><br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/edf88e6d-2133-4057-bbdd-ce696b90ff0c)<br/><br/>
`spring-boot-starter-validation` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë„£ìœ¼ë©´ ìë™ìœ¼ë¡œ Bean Validatorë¥¼ ì¸ì§€í•˜ê³  ìŠ¤í”„ë§ì— í†µí•©í•œë‹¤.<br/><br/>
ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ìë™ìœ¼ë¡œ `LocalValidatorFactoryBean`ì„ ê¸€ë¡œë²Œ Validatorë¡œ ë“±ë¡í•œë‹¤.<br/>
ì´ ValidatorëŠ” `@NotNull` ê°™ì€ ì• ë…¸í…Œì´ì…˜ì„ ë³´ê³  ê²€ì¦ì„ ìˆ˜í–‰í•œë‹¤.<br/>
ì´ë ‡ê²Œ ê¸€ë¡œë²Œ Validatorê°€ ì ìš©ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— `@Valid`, `@Validated`ë§Œ ì ìš©í•˜ë©´ ëœë‹¤.<br/>
ê²€ì¦ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ `FieldError`, `ObjectError`ë¥¼ ìƒì„±í•´ì„œ `BindingResult`ì— ë‹´ì•„ì¤€ë‹¤.<br/><br/>
ë˜í•œ ì§ì ‘ ê¸€ë¡œë²Œ Validatorë¥¼ ë“±ë¡í•˜ë©´ ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” Bean Validatorë¥¼ ê¸€ë¡œë²Œ Validatorë¡œ ë“±ë¡í•˜ì§€ ì•ŠëŠ”ë‹¤.<br/>
ë”°ë¼ì„œ ì• ë…¸í…Œì´ì…˜ ê¸°ë°˜ì˜ ë¹ˆ ê²€ì¦ê¸°ê°€ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.<br/><br/>
### ê²€ì¦ ìˆœì„œ
- `@ModelAttribute` ê°ê°ì˜ í•„ë“œì— íƒ€ì… ë³€í™˜ ì‹œë„
  - ì„±ê³µí•˜ë©´ ë‹¤ìŒìœ¼ë¡œ
  - ì‹¤íŒ¨í•˜ë©´ `typeMismatch`ë¡œ `FieldError` ì¶”ê°€
- Validator ì ìš©
#### ë°”ì¸ë”©ì— ì„±ê³µí•œ í•„ë“œë§Œ Bean Validation ì ìš©
BeanValidatorëŠ” ë°”ì¸ë”©ì— ì‹¤íŒ¨í•œ í•„ë“œëŠ” BeanValidationì„ ì ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.<br/>
íƒ€ì… ë³€í™˜ì— ì„±ê³µí•´ì„œ ë°”ì¸ë”©ì— ì„±ê³µí•œ í•„ë“œì—¬ì•¼ BeanValidation ì ìš©ì´ ì˜ë¯¸ ìˆë‹¤.<br/><br/>
`@ModelAttribute` -> ê°ê°ì˜ í•„ë“œ íƒ€ì… ë³€í™˜ì‹œë„ -> ë³€í™˜ì— ì„±ê³µí•œ í•„ë“œë§Œ BeanValidation ì ìš©<br/><br/>
ì˜ˆ)
- `itemName`ì— ë¬¸ì "A" ì…ë ¥ -> íƒ€ì… ë³€í™˜ ì„±ê³µ -> `itemName` í•„ë“œì— BeanValidation ì ìš©
- `price`ì— ë¬¸ì "A" ì…ë ¥ -> "A"ë¥¼ ìˆ«ì íƒ€ì… ë³€í™˜ ì‹œë„ ì‹¤íŒ¨ -> typeMismatch FieldError ì¶”ê°€ -> `price` í•„ë“œëŠ” BeanValidation ì ìš© X
<br/><br/>
# ğŸ” Bean Validation - ì—ëŸ¬ ì½”ë“œ
Bean Validationì„ ì ìš©í•˜ê³  `bindingResult`ì— ë“±ë¡ëœ ê²€ì¦ ì˜¤ë¥˜ ì½”ë“œë¥¼ ë³´ë©´ ì˜¤ë¥˜ ì½”ë“œê°€ ì• ë…¸í…Œì´ì…˜ ì´ë¦„ìœ¼ë¡œ ë“±ë¡ë˜ëŠ” ê±¸ ì•Œ ìˆ˜ ìˆë‹¤.<br/><br/>
**@NotBlank**
- NotBlank.item.itemName
- NotBlank.itemName
- NotBlank.java.lang.String
- NotBlank
#### 
**@Range**
- Range.item.price
- Range.price
- Range.java.lang.Integer
- Range
<br/><br/>
### ë©”ì‹œì§€ ë“±ë¡
`resources/errors.properties`
```properties
#Bean Validation ì¶”ê°€
NotBlank={0} ê³µë°±X 
Range={0}, {2} ~ {1} í—ˆìš©
Max={0}, ìµœëŒ€ {1}
```
`{0}`ì€ í•„ë“œëª…ì´ê³ , `{1}`, `{2}`... ì€ ê° ì• ë…¸í…Œì´ì…˜ë§ˆë‹¤ ë‹¤ë¥´ë‹¤.<br/><br/>
**BeanValidation ë©”ì‹œì§€ ì°¾ëŠ” ìˆœì„œ**
1. ìƒì„±ëœ ë©”ì‹œì§€ ì½”ë“œ ìˆœì„œëŒ€ë¡œ `messageSource`ì—ì„œ ë©”ì‹œì§€ ì°¾ê¸°
2. ì• ë…¸í…Œì´ì…˜ì˜ `message` ì†ì„± ì‚¬ìš© -> `@NotBlank(message = "ê³µë°±! {0}")`
3. ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì œê³µí•˜ëŠ” ê¸°ë³¸ ê°’ ì‚¬ìš© -> ê³µë°±ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
<br/><br/>
# ğŸ” Bean Validation - ì˜¤ë¸Œì íŠ¸ ì˜¤ë¥˜
Bean Validationì—ì„œ íŠ¹ì • í•„ë“œ(`FieldError`)ê°€ ì•„ë‹Œ í•´ë‹¹ ì˜¤ë¸Œì íŠ¸ ê´€ë ¨ ì˜¤ë¥˜(`ObjectError`)ëŠ” `@ScriptAssert()`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.<br/><br/>
`main/java/hello/itemservice/domain/item/Item`
```java
@Data
@ScriptAssert(lang = "javascript", script = "_this.price * _this.quantity >= 10000", message = "ì´í•©ì´ 10000ì› ë„˜ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.")
public class Item {
```
ì‹¤í–‰í•´ë³´ë©´ ì •ìƒ ìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ë©”ì‹œì§€ ì½”ë“œë„ ë‹¤ìŒê³¼ ê°™ì´ ìƒì„±ëœë‹¤.<br/><br/>
**ë©”ì‹œì§€ ì½”ë“œ**
- ScriptAssert.item
- ScriptAssert
#### 
ê·¸ëŸ°ë° ì‹¤ì œ ì‚¬ìš©í•´ë³´ë©´ ì œì•½ì´ ë§ê³  ë³µì¡í•˜ë‹¤.<br/>
ê·¸ë¦¬ê³  ì‹¤ë¬´ì—ì„œëŠ” ê²€ì¦ ê¸°ëŠ¥ì´ í•´ë‹¹ ê°ì²´ì˜ ë²”ìœ„ë¥¼ ë„˜ì–´ì„œëŠ” ê²½ìš°ë“¤ë„ ì¢…ì¢… ë“±ì¥í•˜ëŠ”ë°, ê·¸ëŸ° ê²½ìš° ëŒ€ì‘ì´ ì–´ë µë‹¤.<br/><br/>
ë”°ë¼ì„œ ì˜¤ë¸Œì íŠ¸ ì˜¤ë¥˜(ê¸€ë¡œë²Œ ì˜¤ë¥˜)ì˜ ê²½ìš° `@ScriptAssert`ë¥¼ ì–µì§€ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒ ë³´ë‹¤ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì˜¤ë¸Œì íŠ¸ ì˜¤ë¥˜ ê´€ë ¨ ë¶€ë¶„ë§Œ **ì§ì ‘ ìë°” ì½”ë“œ**ë¡œ ì‘ì„±í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.<br/><br/>
`main/java/hello/itemservice/web/validation/ValidationItemControllerV3`
```java
    @PostMapping("/add")
    public String addItem(@Validated @ModelAttribute Item item, BindingResult bindingResult, RedirectAttributes redirectAttributes) {

        //íŠ¹ì • í•„ë“œê°€ ì•„ë‹Œ ë³µí•© ë£° ê²€ì¦
        if (item.getPrice() != null && item.getQuantity() != null) {
            int resultPrice = item.getPrice() * item.getQuantity();
            if (resultPrice < 10000) {
                bindingResult.reject("totalPriceMin", new Object[]{10000, resultPrice}, null);
            }
        }

        //ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
        ...
```
<br/><br/>
# ğŸ” Bean Validation - ìˆ˜ì •ì— ì ìš©
ìƒí’ˆ ìˆ˜ì •ì—ë„ ë¹ˆ ê²€ì¦(Bean Validation)ì„ ì ìš©í•œë‹¤.<br/><br/>
`main/java/hello/itemservice/web/validation/ValidationItemControllerV3`
```java
    @PostMapping("/{itemId}/edit")
    public String edit(@PathVariable Long itemId, @Validated @ModelAttribute Item item, BindingResult bindingResult) {

        //íŠ¹ì • í•„ë“œê°€ ì•„ë‹Œ ë³µí•© ë£° ê²€ì¦
        if (item.getPrice() != null && item.getQuantity() != null) {
            int resultPrice = item.getPrice() * item.getQuantity();
            if (resultPrice < 10000) {
                bindingResult.reject("totalPriceMin", new Object[]{10000, resultPrice}, null);
            }
        }

        if (bindingResult.hasErrors()) {
            log.info("errors={}", bindingResult);
            return "validation/v3/editForm";
        }

        itemRepository.update(itemId, item);
        return "redirect:/validation/v3/items/{itemId}";
    }
```
<br/><br/>`validation/v3/editForm.html`ì— `.field-error` css, ê¸€ë¡œë²Œ ì˜¤ë¥˜ ë©”ì‹œì§€, í•„ë“œ ê²€ì¦ ê¸°ëŠ¥ì„ ì¶”ê°€í•œë‹¤.<br/><br/>
# ğŸ” Bean Validation - í•œê³„
ë°ì´í„°ë¥¼ ë“±ë¡í•  ë•Œì™€ ìˆ˜ì •í•  ë•Œì˜ ìš”êµ¬ì‚¬í•­ì´ ë‹¤ë¥¼ ìˆ˜ ìˆë‹¤.<br/><br/>
#### ìˆ˜ì • ì‹œ ìš”êµ¬ì‚¬í•­
- ë“±ë¡ ì‹œì—ëŠ” `quantity` ìˆ˜ëŸ‰ì„ ìµœëŒ€ 9999ê¹Œì§€ ë“±ë¡í•  ìˆ˜ ìˆì§€ë§Œ ìˆ˜ì • ì‹œì—ëŠ” ìˆ˜ëŸ‰ì„ ë¬´ì œí•œìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.
- ë“±ë¡ ì‹œì—ëŠ” `id`ì— ê°’ì´ ì—†ì–´ë„ ë˜ì§€ë§Œ, ìˆ˜ì • ì‹œì—ëŠ” id ê°’ì´ í•„ìˆ˜ì´ë‹¤.
#### 
<br/><br/>ìš”êµ¬ì‚¬í•­ì´ ë‹¤ë¥´ë©´ `item`ì€ ë“±ë¡ê³¼ ìˆ˜ì •ì—ì„œ ê²€ì¦ ì¡°ê±´ì˜ ì¶©ëŒì´ ë°œìƒí•˜ê³ , ë“±ë¡ê³¼ ìˆ˜ì •ì€ ê°™ì€ BeanValidationì„ ì ìš©í•  ìˆ˜ ì—†ë‹¤.<br/>
ì´ ë¬¸ì œë¥¼ ì–´ë–»ê²Œ í•´ê²°í•  ìˆ˜ ìˆì„ê¹Œ?<br/><br/>
# ğŸ” Bean Validation - groups
ë™ì¼í•œ ëª¨ë¸ ê°ì²´ë¥¼ ë“±ë¡í•  ë•Œì™€ ìˆ˜ì •í•  ë•Œ ê°ê° ë‹¤ë¥´ê²Œ ê²€ì¦í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³¸ë‹¤.<br/><br/>
### ë°©ë²• 2ê°€ì§€
- BeanValidationì˜ **groups ê¸°ëŠ¥**ì„ ì‚¬ìš©í•œë‹¤.
- Itemì„ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ItemSaveForm, ItemUpdateForm ê°™ì€ í¼ ì „ì†¡ì„ ìœ„í•œ **ë³„ë„ì˜ ëª¨ë¸ ê°ì²´**ë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•œë‹¤.
<br/><br/>
### BeanValidation groups ê¸°ëŠ¥ ì‚¬ìš©
**ì €ì¥ìš© groups ìƒì„±** <br/>
`main/java/hello/itemservice/domain/item/SaveCheck`
```java
public interface SavaCheck {
}
```
<br/><br/>**ìˆ˜ì •ìš© groups ìƒì„±** <br/>
`main/java/hello/itemservice/domain/item/UpdateCheck`
```java
public interface UpdateCheck {
}
```
<br/><br/>**Item - groups ì ìš©** <br/>
`main/java/hello/itemservice/domain/item/Item`
```java
@Data
public class Item {

    @NotNull(groups = UpdateCheck.class)
    private Long id;

    @NotBlank(groups = {SavaCheck.class, UpdateCheck.class})
    private String itemName;

    @NotNull(groups = {SavaCheck.class, UpdateCheck.class})
    @Range(min = 1000, max = 1000000, groups = {SavaCheck.class, UpdateCheck.class})
    private Integer price;

    @NotNull(groups = {SavaCheck.class, UpdateCheck.class})
    @Max(value = 9999, groups = SavaCheck.class)
    private Integer quantity;

    ...
```
<br/><br/>**ì €ì¥ ë¡œì§ì— SaveCheck Groups ì ìš©** <br/>
`main/java/hello/itemservice/web/validation/ValidationItemControllerV3`
```java
    @PostMapping("/add")
    public String addItem2(@Validated(SavaCheck.class) @ModelAttribute Item item, BindingResult bindingResult, RedirectAttributes redirectAttributes) {
        ...
    }
```
<br/><br/>**ìˆ˜ì • ë¡œì§ì— UpdateCheck Groups ì ìš©** <br/>
`main/java/hello/itemservice/web/validation/ValidationItemControllerV3`
```java
    @PostMapping("/{itemId}/edit")
    public String edit2(@PathVariable Long itemId, @Validated(UpdateCheck.class) @ModelAttribute Item item, BindingResult bindingResult) {
        ...
    }
```
`@Valid`ì—ëŠ” groupsë¥¼ ì ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ ì—†ë‹¤.<br/>
ë”°ë¼ì„œ groupsë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ `@Validated`ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.<br/><br/>
groups ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì„œ ë“±ë¡ê³¼ ìˆ˜ì • ì‹œì— ê°ê° ë‹¤ë¥´ê²Œ ê²€ì¦ì„ í•  ìˆ˜ ìˆì—ˆë‹¤.<br/>
ê·¸ëŸ°ë° groups ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë‹ˆ `Item`ì€ ë¬¼ë¡ ì´ê³ , ì „ë°˜ì ìœ¼ë¡œ ë³µì¡ë„ê°€ ì˜¬ë¼ê°”ë‹¤.<br/>
groups ê¸°ëŠ¥ì€ ì˜ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ”ë°, ì‹¤ë¬´ì—ì„œëŠ” ì£¼ë¡œ ë“±ë¡ìš© í¼ ê°ì²´ì™€ ìˆ˜ì •ìš© í¼ ê°ì²´ë¥¼ ë¶„ë¦¬í•´ì„œ ì‚¬ìš©í•œë‹¤.<br/><br/>
# ğŸ” Form ì „ì†¡ ê°ì²´ ë¶„ë¦¬ - ì†Œê°œ
ì‹¤ë¬´ì—ì„œ groupsë¥¼ ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì´ìœ ëŠ” ë“±ë¡ ì‹œ í¼ì—ì„œ ì „ë‹¬í•˜ëŠ” ë°ì´í„°ê°€ `Item` ë„ë©”ì¸ ê°ì²´ì™€ ë”± ë§ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤.<br/><br/>
ì‹¤ë¬´ì—ì„œëŠ” íšŒì› ë“±ë¡ ì‹œ íšŒì›ê³¼ ê´€ë ¨ëœ ë°ì´í„°ë§Œ ì „ë‹¬ë°›ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì•½ê´€ ì •ë³´ë„ ì¶”ê°€ë¡œ ë°›ëŠ” ë“± `Item`ê³¼ ê´€ê³„ì—†ëŠ” ìˆ˜ ë§ì€ ë¶€ê°€ ë°ì´í„°ê°€ ë„˜ì–´ì˜¨ë‹¤.<br/>
ê·¸ë˜ì„œ ë³´í†µ `Item`ì„ ì§ì ‘ ì „ë‹¬ë°›ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë³µì¡í•œ í¼ì˜ ë°ì´í„°ë¥¼ ì»¨íŠ¸ë¡¤ëŸ¬ê¹Œì§€ ì „ë‹¬í•  ë³„ë„ì˜ ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ì „ë‹¬í•œë‹¤.<br/>
ì˜ˆë¥¼ ë“¤ë©´ `ItemSaveForm`ì´ë¼ëŠ” í¼ì„ ì „ë‹¬ë°›ëŠ” ì „ìš© ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ `@ModelAttribute`ë¡œ ì‚¬ìš©í•œë‹¤.
ì´ê²ƒì„ í†µí•´ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ í¼ ë°ì´í„°ë¥¼ ì „ë‹¬ ë°›ê³ , ì´í›„ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ í•„ìš”í•œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•´ì„œ `Item`ì„ ìƒì„±í•œë‹¤.<br/><br/>
**í¼ ë°ì´í„° ì „ë‹¬ì„ ìœ„í•œ ë³„ë„ì˜ ê°ì²´ ì‚¬ìš©**
- `HTML Form -> ItemSaveForm -> Controller -> Item ìƒì„± -> Repository`
  - ì¥ì : ì „ì†¡í•˜ëŠ” í¼ ë°ì´í„°ê°€ ë³µì¡í•´ë„ ê±°ê¸°ì— ë§ì¶˜ ë³„ë„ì˜ í¼ ê°ì²´ë¥¼ ì‚¬ìš©í•´ì„œ ë°ì´í„°ë¥¼ ì „ë‹¬ ë°›ì„ ìˆ˜ ìˆë‹¤. ë³´í†µ ë“±ë¡ê³¼, ìˆ˜ì •ìš©ìœ¼ë¡œ ë³„ë„ì˜ í¼ ê°ì²´ë¥¼ ë§Œë“¤ê¸° ë•Œë¬¸ì— ê²€ì¦ì´ ì¤‘ë³µë˜ì§€ ì•ŠëŠ”ë‹¤.
  - ë‹¨ì : í¼ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ Item ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ë³€í™˜ ê³¼ì •ì´ ì¶”ê°€ëœë‹¤.
#### 
ë˜í•œ, ë“±ë¡ê³¼ ìˆ˜ì •ì€ ì™„ì „íˆ ë‹¤ë¥¸ ë°ì´í„°ê°€ ë„˜ì–´ì˜¨ë‹¤.<br/>
ì˜ˆë¥¼ ë“¤ë©´ ë“±ë¡ ì‹œì—ëŠ” ë¡œê·¸ì¸id, ì£¼ë¯¼ë²ˆí˜¸ ë“±ì„ ë°›ì„ ìˆ˜ ìˆì§€ë§Œ, ìˆ˜ì • ì‹œì—ëŠ” ì´ëŸ° ë¶€ë¶„ì´ ë¹ ì§€ê³  ê²€ì¦ ë¡œì§ë„ ë§ì´ ë‹¬ë¼ì§„ë‹¤.<br/><br/>
ë”°ë¼ì„œ ì´ë ‡ê²Œ í¼ ë°ì´í„° ì „ë‹¬ì„ ìœ„í•œ ë³„ë„ì˜ ê°ì²´ë¥¼ ì‚¬ìš©í•˜ê³  ë“±ë¡, ìˆ˜ì •ìš© í¼ ê°ì²´ë¥¼ ë‚˜ëˆ„ë©´ ë“±ë¡, ìˆ˜ì •ì´ ì™„ì „íˆ ë¶„ë¦¬ë˜ê¸° ë•Œë¬¸ì— groupsë¥¼ ì ìš©í•  ì¼ì€ ë“œë¬¼ë‹¤.<br/><br/>
# ğŸ” Form ì „ì†¡ ê°ì²´ ë¶„ë¦¬ - ê°œë°œ
**Item ì›ë³µ**<br/>
`main/java/hello/itemservice/domain/item/Item`
```java
@Data
public class Item {

    private Long id;
    private String itemName;
    private Integer price;
    private Integer quantity;

    ...
```
<br/><br/>**Item ì €ì¥ìš© í¼**<br/>
`main/java/hello/itemservice/web/validation/form/ItemSaveForm`
```java
@Data
public class ItemSaveForm {

    @NotBlank
    private String itemName;

    @NotNull
    @Range(min = 1000, max = 1000000)
    private Integer price;

    @NotNull
    @Max(9999)
    private Integer quantity;
}
```
<br/><br/>**Item ìˆ˜ì •ìš© í¼**<br/>
`main/java/hello/itemservice/web/validation/form/ItemUpdateForm`
```java
@Data
public class ItemUpdateForm {

    @NotNull
    private Long id;

    @NotBlank
    private String itemName;

    @NotNull
    @Range(min = 1000, max = 1000000)
    private Integer price;

    //ìˆ˜ì •ì—ì„œ ìˆ˜ëŸ‰ì€ ììœ ë¡­ê²Œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.
    private Integer quantity;
}
```
<br/><br/>**ì»¨íŠ¸ë¡¤ëŸ¬ ìˆ˜ì •**<br/>
`main/java/hello/itemservice/web/validation/ValidationItemControllerV4`
```java
    ...

    @PostMapping("/add")
    public String addItem(@Validated @ModelAttribute("item") ItemSaveForm form, BindingResult bindingResult, RedirectAttributes redirectAttributes) {

        //íŠ¹ì • í•„ë“œê°€ ì•„ë‹Œ ë³µí•© ë£° ê²€ì¦
        if (form.getPrice() != null && form.getQuantity() != null) {
            int resultPrice = form.getPrice() * form.getQuantity();
            if (resultPrice < 10000) {
                bindingResult.reject("totalPriceMin", new Object[]{10000, resultPrice}, null);
            }
        }

        //ê²€ì¦ì— ì‹¤íŒ¨í•˜ë©´ ë‹¤ì‹œ ì…ë ¥ í¼ìœ¼ë¡œ
        if (bindingResult.hasErrors()) {
            log.info("errors={}", bindingResult);
            return "validation/v4/addForm";
        }

        //ì„±ê³µ ë¡œì§
        Item item = new Item();
        item.setItemName(form.getItemName());
        item.setPrice(form.getPrice());
        item.setQuantity(form.getQuantity());

        Item savedItem = itemRepository.save(item);
        redirectAttributes.addAttribute("itemId", savedItem.getId());
        redirectAttributes.addAttribute("status", true);
        return "redirect:/validation/v4/items/{itemId}";
    }

    ...

    @PostMapping("/{itemId}/edit")
    public String edit2(@PathVariable Long itemId, @Validated @ModelAttribute("item") ItemUpdateForm form, BindingResult bindingResult) {

        //íŠ¹ì • í•„ë“œê°€ ì•„ë‹Œ ë³µí•© ë£° ê²€ì¦
        if (form.getPrice() != null && form.getQuantity() != null) {
            int resultPrice = form.getPrice() * form.getQuantity();
            if (resultPrice < 10000) {
                bindingResult.reject("totalPriceMin", new Object[]{10000, resultPrice}, null);
            }
        }

        if (bindingResult.hasErrors()) {
            log.info("errors={}", bindingResult);
            return "validation/v4/editForm";
        }

        Item itemParam = new Item();
        itemParam.setItemName(form.getItemName());
        itemParam.setPrice(form.getPrice());
        itemParam.setQuantity(form.getQuantity());

        itemRepository.update(itemId, itemParam);
        return "redirect:/validation/v4/items/{itemId}";
    }
}
```
í¼ ê°ì²´ì˜ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ `Item` ê°ì²´ë¥¼ ìƒì„±í•œë‹¤. ì´ë ‡ê²Œ ì¤‘ê°„ì— ë‹¤ë¥¸ ê°ì²´ê°€ ì¶”ê°€ë˜ë©´ ë³€í™˜í•˜ëŠ” ê³¼ì •ì´ ì¶”ê°€ëœë‹¤.<br/><br/>
Form ì „ì†¡ ê°ì²´ ë¶„ë¦¬í•´ì„œ ë“±ë¡ê³¼ ìˆ˜ì •ì— ë”± ë§ëŠ” ê¸°ëŠ¥ì„ êµ¬ì„±í•˜ê³ , ê²€ì¦ë„ ëª…í™•íˆ ë¶„ë¦¬í–ˆë‹¤.<br/><br/>
# ğŸ” Bean Validation - HTTP ë©”ì‹œì§€ ì»¨ë²„í„°
`@Valid`, `@Validated`ëŠ” `HttpMessageConverter`(`@RequestBody`)ì—ë„ ì ìš©í•  ìˆ˜ ìˆë‹¤.

> **ì°¸ê³ **<br/>
> `@ModelAttribute`ëŠ” HTTP ìš”ì²­ íŒŒë¼ë¯¸í„°(URL ì¿¼ë¦¬ ìŠ¤íŠ¸ë§, POST Form)ë¥¼ ë‹¤ë£° ë•Œ ì‚¬ìš©í•œë‹¤.<br/>
> `@RequestBody`ëŠ” HTTP Bodyì˜ ë°ì´í„°ë¥¼ ê°ì²´ë¡œ ë³€í™˜í•  ë•Œ ì‚¬ìš©í•œë‹¤. ì£¼ë¡œ API JSON ìš”ì²­ì„ ë‹¤ë£° ë•Œ ì‚¬ìš©í•œë‹¤.
#### 
`main/java/hello/itemservice/web/validation/ValidationItemApiController`
```java
@Slf4j
@RestController
@RequestMapping("/validation/api/items")
public class ValidationItemApiController {

    @PostMapping("/add")
    public Object addItem(@RequestBody @Validated ItemSaveForm form, BindingResult bindingResult) {

        log.info("API ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ");

        if (bindingResult.hasErrors()) {
            log.info("ê²€ì¦ ì˜¤ë¥˜ ë°œìƒ errors={}", bindingResult);
            return bindingResult.getAllErrors();
        }

        log.info("ì„±ê³µ ë¡œì§ ì‹¤í–‰");
        return form;
    }
}
```
<br/><br/>**ì„±ê³µ ìš”ì²­**<br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/71cbdb08-0367-4f6b-ad93-5e4d282104ef)<br/><br/>
**ì‹¤íŒ¨ ìš”ì²­**<br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/677c4ed4-d1f6-41a2-8022-0339ff57ba30)<br/>
`price`ì˜ ê°’ì— ìˆ«ìê°€ ì•„ë‹Œ ë¬¸ìë¥¼ ì „ë‹¬í•œë‹¤.<br/>
JSONì„ ê°ì²´ë¡œ ìƒì„±í•˜ëŠ” ê²ƒ ìì²´ê°€ ì‹¤íŒ¨<br/><br/>
**ê²€ì¦ ì˜¤ë¥˜ ìš”ì²­**<br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/4979429d-569b-433d-a74c-d5787469f9eb)<br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/1cf389c4-6801-4517-b996-f8767ea41295)<br/>
JSONì„ ê°ì²´ë¡œ ìƒì„±í•˜ëŠ” ê²ƒì€ ì„±ê³µí–ˆê³ , ê²€ì¦ì—ì„œ ì‹¤íŒ¨<br/><br/>
`return bindingResult.getAllErrors();`ëŠ” `ObjectError`ì™€ `FieldError`ë¥¼ ë°˜í™˜í•œë‹¤.<br/>
ìŠ¤í”„ë§ì´ ì´ ê°ì²´ë¥¼ JSONìœ¼ë¡œ ë³€í™˜í•´ì„œ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬í–ˆë‹¤.<br/>
ì—¬ê¸°ì„œëŠ” ì˜ˆì‹œë¡œ ë³´ì—¬ì£¼ê¸° ìœ„í•´ì„œ ê²€ì¦ ì˜¤ë¥˜ ê°ì²´ë“¤ì„ ê·¸ëŒ€ë¡œ ë°˜í™˜í–ˆë‹¤.<br/>
ì‹¤ì œ ê°œë°œí•  ë•ŒëŠ” ì´ ê°ì²´ë“¤ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì§€ ë§ê³ , í•„ìš”í•œ ë°ì´í„°ë§Œ ë½‘ì•„ì„œ ë³„ë„ì˜ API ìŠ¤í™ì„ ì •ì˜í•˜ê³  ê·¸ì— ë§ëŠ” ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ë°˜í™˜í•´ì•¼ í•œë‹¤.<br/><br/>
- `@ModelAttribute`ëŠ” í•„ë“œ ë‹¨ìœ„ë¡œ ì •êµí•˜ê²Œ ë°”ì¸ë”©ì´ ì ìš©ëœë‹¤. íŠ¹ì • í•„ë“œê°€ ë°”ì¸ë”© ë˜ì§€ ì•Šì•„ë„ ë‚˜ë¨¸ì§€ í•„ë“œëŠ” ì •ìƒ ë°”ì¸ë”© ë˜ê³ , Validatorë¥¼ ì‚¬ìš©í•œ ê²€ì¦ë„ ì ìš©í•  ìˆ˜ ìˆë‹¤.
- `@RequestBody`ëŠ” HttpMessageConverter ë‹¨ê³„ì—ì„œ JSON ë°ì´í„°ë¥¼ ê°ì²´ë¡œ ë³€ê²½í•˜ì§€ ëª»í•˜ë©´ ì´í›„ ë‹¨ê³„ ìì²´ê°€ ì§„í–‰ë˜ì§€ ì•Šê³  ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤. ì»¨íŠ¸ë¡¤ëŸ¬ë„ í˜¸ì¶œë˜ì§€ ì•Šê³ , Validatorë„ ì ìš©í•  ìˆ˜ ì—†ë‹¤.