# ğŸ“– API ì˜ˆì™¸ ì²˜ë¦¬
<br/><br/>
# ğŸ” API ì˜ˆì™¸ ì²˜ë¦¬ - ì‹œì‘
APIì˜ ê²½ìš°ì—ëŠ” ìƒê°í•  ë‚´ìš©ì´ ë” ë§ë‹¤.<br/>
ì˜¤ë¥˜ í˜ì´ì§€ëŠ” ë‹¨ìˆœíˆ ê³ ê°ì—ê²Œ ì˜¤ë¥˜ í™”ë©´ì„ ë³´ì—¬ì£¼ê³  ëì´ì§€ë§Œ, APIëŠ” ê° ì˜¤ë¥˜ ìƒí™©ì— ë§ëŠ” ì˜¤ë¥˜ ì‘ë‹µ ìŠ¤í™ì„ ì •í•˜ê³ , JSONìœ¼ë¡œ ë°ì´í„°ë¥¼ ë‚´ë ¤ì£¼ì–´ì•¼ í•œë‹¤.<br/><br/>
### WebServerCustomizer ë‹¤ì‹œ ë™ì‘
`java/hello/exception/WebServerCustomizer`
```java
@Component
public class WebServerCustomizer implements WebServerFactoryCustomizer<ConfigurableWebServerFactory> {
    ...
```
`WebServerCustomizer`ê°€ ë‹¤ì‹œ ì‚¬ìš©ë˜ë„ë¡ í•˜ê¸° ìœ„í•´ `@Component` ì• ë…¸í…Œì´ì…˜ì— ìˆëŠ” ì£¼ì„ì„ í‘¼ë‹¤.<br/>
ì´ì œ WASì— ì˜ˆì™¸ê°€ ì „ë‹¬ë˜ê±°ë‚˜, `response.sendError()`ê°€ í˜¸ì¶œë˜ë©´ ìœ„ì— ë“±ë¡í•œ ì˜ˆì™¸ í˜ì´ì§€ ê²½ë¡œê°€ í˜¸ì¶œëœë‹¤.<br/><br/>
### API ì˜ˆì™¸ ì»¨íŠ¸ë¡¤ëŸ¬
`java/hello/exception/api/ApiExceptionController`
```java
@Slf4j
@RestController
public class ApiExceptionController {

    @GetMapping("/api/members/{id}")
    public MemberDto getMember(@PathVariable("id") String id) {
        if (id.equals("ex")) {
            throw new RuntimeException("ì˜ëª»ëœ ì‚¬ìš©ì");
        }

        return new MemberDto(id, "hello" + id);
    }

    @Data
    @AllArgsConstructor
    static class MemberDto {
        private String memberId;
        private String name;
    }
}
```
ë‹¨ìˆœíˆ íšŒì›ì„ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤. ì˜ˆì™¸ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ URLì— ì „ë‹¬ëœ `id`ì˜ ê°’ì´ `ex`ì´ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë„ë¡ ì½”ë“œë¥¼ ì‹¬ì–´ë‘ì—ˆë‹¤.<br/><br/>
**Postmanìœ¼ë¡œ í…ŒìŠ¤íŠ¸**<br/>
HTTP Headerì— `Accept`ì„ `application/json`ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•œë‹¤.<br/><br/>
**ì •ìƒ í˜¸ì¶œ**<br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/69a03ae7-926d-40bf-9ebb-367d12755f1b)<br/><br/>
**ì˜ˆì™¸ ë°œìƒ í˜¸ì¶œ**<br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/c8ccd932-3acb-4a25-a64a-aa35ab7ac55d)<br/><br/>
APIë¥¼ ìš”ì²­í–ˆëŠ”ë°, ì •ìƒì˜ ê²½ìš° APIë¡œ JSON í˜•ì‹ìœ¼ë¡œ ë°ì´í„°ê°€ ì •ìƒ ë°˜í™˜ëœë‹¤.<br/>
ê·¸ëŸ°ë° ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ìš°ë¦¬ê°€ ë¯¸ë¦¬ ë§Œë“¤ì–´ë‘” ì˜¤ë¥˜ í˜ì´ì§€ HTMLì´ ë°˜í™˜ëœë‹¤.<br/>
í´ë¼ì´ì–¸íŠ¸ëŠ” ì •ìƒ ìš”ì²­ì´ë“ , ì˜¤ë¥˜ ìš”ì²­ì´ë“  JSONì´ ë°˜í™˜ë˜ê¸°ë¥¼ ê¸°ëŒ€í•œë‹¤.<br/><br/>
ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ë©´ ì˜¤ë¥˜ í˜ì´ì§€ ì»¨íŠ¸ë¡¤ëŸ¬ë„ JSON ì‘ë‹µì„ í•  ìˆ˜ ìˆë„ë¡ ìˆ˜ì •í•´ì•¼ í•œë‹¤.<br/><br/>
### API ì‘ë‹µ ì¶”ê°€
`java/hello/exception/servlet/ErrorPageController`
```java
    ...

    @RequestMapping(value = "/error-page/500", produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity<Map<String, Object>> errorPage500Api(HttpServletRequest request, HttpServletResponse response) {

        log.info("API errorPage 500");

        Map<String, Object> result = new HashMap<>();
        Exception ex = (Exception) request.getAttribute(ERROR_EXCEPTION);
        result.put("status", request.getAttribute(ERROR_STATUS_CODE));
        result.put("message", ex.getMessage());

        Integer statusCode = (Integer) request.getAttribute(RequestDispatcher.ERROR_STATUS_CODE);
        return new ResponseEntity<>(result, HttpStatus.valueOf(statusCode));
    }

    ...
```
`produces = MediaType.APPLICATION_JSON_VALUE`: í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­í•˜ëŠ” HTTP Headerì˜ `Accept`ì˜ ê°’ì´ `application/json`ì¼ ë•Œ í•´ë‹¹ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤.<br/>
í´ë¼ì–´ì¸íŠ¸ê°€ ë°›ê³  ì‹¶ì€ ë¯¸ë””ì–´ íƒ€ì…ì´ jsonì´ë©´ ì´ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤.<br/><br/>
ì‘ë‹µ ë°ì´í„°ë¥¼ ìœ„í•´ì„œ `Map`ì„ ë§Œë“¤ê³  `status`, `message` í‚¤ì— ê°’ì„ í• ë‹¹í–ˆë‹¤. Jackson ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” `Map`ì„ JSON êµ¬ì¡°ë¡œ ë³€í™˜í•  ìˆ˜ ìˆë‹¤.<br/>
`ResponseEntity`ë¥¼ ì‚¬ìš©í•´ì„œ ì‘ë‹µí•˜ê¸° ë•Œë¬¸ì— ë©”ì‹œì§€ ì»¨ë²„í„°ê°€ ë™ì‘í•˜ë©´ì„œ í´ë¼ì´ì–¸íŠ¸ì— JSONì´ ë°˜í™˜ëœë‹¤.<br/><br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/c7c10980-ef2d-4171-8a34-7134194e7e73)<br/><br/>
# ğŸ” ìŠ¤í”„ë§ ë¶€íŠ¸ ê¸°ë³¸ ì˜¤ë¥˜ ì²˜ë¦¬
API ì˜ˆì™¸ ì²˜ë¦¬ë„ ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ ì œê³µí•˜ëŠ” ê¸°ë³¸ ì˜¤ë¥˜ ë°©ì‹ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.<br/>
ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ ì œê³µí•˜ëŠ” `BasicErrorController` ì½”ë“œë¥¼ ë³´ì.<br/><br/>
`BasicErrorController`
```java
@RequestMapping(produces = MediaType.TEXT_HTML_VALUE)
public ModelAndView errorHtml(HttpServletRequest request, HttpServletResponse response) {}

@RequestMapping
public ResponseEntity<Map<String, Object>> error(HttpServletRequest request) {}
```
`errorHtml()`: `produces = MediaType.TEXT_HTML_VALUE`ë¡œ ì¸í•´ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì˜ Accept í•´ë” ê°’ì´ `text/html`ì¸ ê²½ìš°ì—ëŠ” `errorHtml()`ì„ í˜¸ì¶œí•´ì„œ viewë¥¼ ì œê³µí•œë‹¤.<br/>
`error()`: ê·¸ì™¸ ê²½ìš°ì— í˜¸ì¶œë˜ê³  `ResponseEntity`ë¡œ HTTP Bodyì— JSON ë°ì´í„°ë¥¼ ë°˜í™˜í•œë‹¤.<br/><br/>
**Postmanìœ¼ë¡œ ì‹¤í–‰**<br/>
(`BasicErrorController`ë¥¼ ì‚¬ìš©í•˜ë„ë¡ `WebServerCustomizer`ì˜ `@Component`ë¥¼ ì£¼ì„ì²˜ë¦¬ í•˜ê³ , AcceptëŠ” `application/json`ìœ¼ë¡œ ì„¤ì •í•œë‹¤.)<br/><br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/61b0a43a-e601-4697-a445-dec71d5c7ea8)<br/><br/>
ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” `BasicErrorController`ê°€ ì œê³µí•˜ëŠ” ê¸°ë³¸ ì •ë³´ë“¤ì„ í™œìš©í•´ì„œ ì˜¤ë¥˜ APIë¥¼ ìƒì„±í•´ì¤€ë‹¤.<br/><br/>
### Html í˜ì´ì§€ vs API ì˜¤ë¥˜
`BasicErrorController`ë¥¼ í™•ì¥í•˜ë©´ JSON ë©”ì‹œì§€ë„ ë³€ê²½í•  ìˆ˜ ìˆë‹¤. ê·¸ëŸ°ë° API ì˜¤ë¥˜ëŠ” ì¡°ê¸ˆ ë’¤ì— ì„¤ëª…í•  `@ExceptionHandler`ê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ë‚˜ì€ ë°©ë²•ì´ë¯€ë¡œ ì§€ê¸ˆì€ `BasicErrorController`ë¥¼ í™•ì¥í•´ì„œ JSON ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤ ì •ë„ë¡œë§Œ ì´í•´í•´ë‘ì.<br/><br/>
ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ ì œê³µí•˜ëŠ” `BasicErrorController`ëŠ” HTML í˜ì´ì§€ë¥¼ ì œê³µí•˜ëŠ” ê²½ìš°ì—ëŠ” ë§¤ìš° í¸ë¦¬í•˜ë‹¤. 4xx, 5xx ë“±ë“± ëª¨ë‘ ì˜ ì²˜ë¦¬í•´ì¤€ë‹¤. ê·¸ëŸ°ë° API ì˜¤ë¥˜ ì²˜ë¦¬ëŠ” ë‹¤ë¥¸ ì°¨ì›ì˜ ì´ì•¼ê¸°ì´ë‹¤. API ë§ˆë‹¤, ê°ê°ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë‚˜ ì˜ˆì™¸ë§ˆë‹¤ ì„œë¡œ ë‹¤ë¥¸ ì‘ë‹µ ê²°ê³¼ë¥¼ ì¶œë ¥í•´ì•¼ í•  ìˆ˜ë„ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ íšŒì›ê³¼ ê´€ë ¨ëœ APIì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•  ë•Œ ì‘ë‹µê³¼, ìƒí’ˆê³¼ ê´€ë ¨ëœ APIì—ì„œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ì— ë”°ë¼ ê·¸ ê²°ê³¼ê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆë‹¤.<br/><br/>
ê²°ê³¼ì ìœ¼ë¡œ ë§¤ìš° ì„¸ë°€í•˜ê³  ë³µì¡í•˜ë‹¤. ë”°ë¼ì„œ ì´ ë°©ë²•ì€ HTML í™”ë©´ì„ ì²˜ë¦¬í•  ë•Œ ì‚¬ìš©í•˜ê³ , API ì˜¤ë¥˜ ì²˜ë¦¬ëŠ” ë’¤ì—ì„œ ì„¤ëª…í•  `@ExceptionHandler`ë¥¼ ì‚¬ìš©í•˜ì.<br/><br/>
# ğŸ” HandlerExceptionResolver ì‹œì‘
ì˜ˆì™¸ê°€ ë°œìƒí•´ì„œ ì„œë¸”ë¦¿ì„ ë„˜ì–´ WASê¹Œì§€ ì˜ˆì™¸ê°€ ì „ë‹¬ë˜ë©´ HTTP ìƒíƒœì½”ë“œê°€ 500ìœ¼ë¡œ ì²˜ë¦¬ëœë‹¤.<br/>
ë°œìƒí•˜ëŠ” ì˜ˆì™¸ì— ë”°ë¼ì„œ 400, 404 ë“± ë‹¤ë¥¸ ìƒíƒœì½”ë“œë¡œ ì²˜ë¦¬í•˜ê³  ì‹¶ë‹¤. ì˜¤ë¥˜ ë©”ì‹œì§€, í˜•ì‹ ë“±ì„ APIë§ˆë‹¤ ë‹¤ë¥´ê²Œ ì²˜ë¦¬í•˜ê³  ì‹¶ë‹¤.<br/><br/>
**ìƒíƒœì½”ë“œ ë³€í™˜**<br/>
ì˜ˆë¥¼ ë“¤ì–´ì„œ `IllegalArgumentException`ì„ ì²˜ë¦¬í•˜ì§€ ëª»í•´ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ ë°–ìœ¼ë¡œ ë„˜ì–´ê°€ëŠ” ì¼ì´ ë°œìƒí•˜ë©´ HTTP ìƒíƒœì½”ë“œë¥¼ 400ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ì‹¶ë‹¤.<br/><br/>
`java/hello/exception/api/ApiExceptionController`
```java
@Slf4j
@RestController
public class ApiExceptionController {

    @GetMapping("/api/members/{id}")
    public MemberDto getMember(@PathVariable("id") String id) {

        if (id.equals("ex")) {
            throw new RuntimeException("ì˜ëª»ëœ ì‚¬ìš©ì");
        }
        if (id.equals("bad")) {
            throw new IllegalArgumentException("ì˜ëª»ëœ ì…ë ¥ ê°’");
        }

        return new MemberDto(id, "hello" + id);
    }

    ...
```
http://localhost:8080/api/members/bad ë¼ê³  í˜¸ì¶œí•˜ë©´ `IllegalArgumentException`ì´ ë°œìƒí•˜ë„ë¡ í–ˆë‹¤.<br/><br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/3346fd42-c137-4629-b9dd-97f60ab3ec8b)<br/><br/>
ì‹¤í–‰í•´ë³´ë©´ ìƒíƒœ ì½”ë“œê°€ 500ì¸ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/><br/>
**HandlerExceptionResolver**<br/>
ìŠ¤í”„ë§ MVCëŠ” ì»¨íŠ¸ë¡¤ëŸ¬(í•¸ë“¤ëŸ¬) ë°–ìœ¼ë¡œ ì˜ˆì™¸ê°€ ë˜ì ¸ì§„ ê²½ìš° ì˜ˆì™¸ë¥¼ í•´ê²°í•˜ê³ , ë™ì‘ì„ ìƒˆë¡œ ì •ì˜í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•œë‹¤.<br/>
ì»¨íŠ¸ë¡¤ëŸ¬ ë°–ìœ¼ë¡œ ë˜ì ¸ì§„ ì˜ˆì™¸ë¥¼ í•´ê²°í•˜ê³ , ë™ì‘ ë°©ì‹ì„ ë³€ê²½í•˜ê³  ì‹¶ìœ¼ë©´ `HandlerExceptionResolver`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. ì¤„ì—¬ì„œ `ExceptionResolver`ë¼ í•œë‹¤.<br/><br/>
**ExceptionResolver ì ìš© ì „**<br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/48ef63f0-6bf0-4133-bb74-e294d335b97c)<br/><br/>
**ExceptionResolver ì ìš© í›„**<br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/19792543-9bde-4f4d-aa30-6767bc25ed73)<br/><br/>
`ExceptionResolver`ë¡œ ì˜ˆì™¸ë¥¼ í•´ê²°í•´ë„ `postHandle()`ì€ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.<br/><br/>
**HandlerExceptionResolver - ì¸í„°í˜ì´ìŠ¤**
```java
public interface HandlerExceptionResolver {
    ModelAndView resolveException(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex);
}
```
`handler`: í•¸ë“¤ëŸ¬(ì»¨íŠ¸ë¡¤ëŸ¬) ì •ë³´<br/>
`Exception ex`: í•¸ë“¤ëŸ¬(ì»¨íŠ¸ë¡¤ëŸ¬)ì—ì„œ ë°œìƒí•œ ë°œìƒí•œ ì˜ˆì™¸<br/><br/>
`java/hello/exception/resolver/MyHandlerExceptionResolver`
```java
@Slf4j
public class MyHandlerExceptionResolver implements HandlerExceptionResolver {

    @Override
    public ModelAndView resolveException(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) {

        try {
            if (ex instanceof IllegalArgumentException) {
                log.info("IllegalArgumentException resolver to 400");

                response.sendError(HttpServletResponse.SC_BAD_REQUEST, ex.getMessage());
                return new ModelAndView();
            }
        } catch (IOException e) {
            log.error("resolver ex", e);
        }

        return null;
    }
}
```
`ExceptionResolver`ê°€ `ModelAndView`ë¥¼ ë°˜í™˜í•˜ëŠ” ì´ìœ ëŠ” ë§ˆì¹˜ try, catchë¥¼ í•˜ë“¯ì´, `Exception`ì„ ì²˜ë¦¬í•´ì„œ ì •ìƒ íë¦„ ì²˜ëŸ¼ ë³€ê²½í•˜ëŠ” ê²ƒì´ ëª©ì ì´ë‹¤.<br/>
ì´ë¦„ ê·¸ëŒ€ë¡œ `Exception`ì„ Resolver(í•´ê²°)í•˜ëŠ” ê²ƒì´ ëª©ì ì´ë‹¤.<br/><br/>
ì—¬ê¸°ì„œëŠ” `IllegalArgumentException`ì´ ë°œìƒí•˜ë©´ `response.sendError(400)`ë¥¼ í˜¸ì¶œí•´ì„œ HTTP ìƒíƒœ ì½”ë“œë¥¼ 400ìœ¼ë¡œ ì§€ì •í•˜ê³ , ë¹ˆ `ModelAndView`ë¥¼ ë°˜í™˜í•œë‹¤.<br/><br/>
#### ë°˜í™˜ ê°’ì— ë”°ë¥¸ ë™ì‘ ë°©ì‹
- ë¹ˆ ModelAndView: `new ModelAndView()`ì²˜ëŸ¼ ë¹ˆ `ModelAndView`ë¥¼ ë°˜í™˜í•˜ë©´ ë·°ë¥¼ ë Œë”ë§ í•˜ì§€ ì•Šê³ , ì •ìƒ íë¦„ìœ¼ë¡œ ì„œë¸”ë¦¿ì´ ë¦¬í„´ëœë‹¤.<br/>
- ModelAndView ì§€ì •: `ModelAndView`ì— `View`, `Model` ë“±ì˜ ì •ë³´ë¥¼ ì§€ì •í•´ì„œ ë°˜í™˜í•˜ë©´ ë·°ë¥¼ ë Œë”ë§í•œë‹¤.<br/>
- null: `null`ì„ ë°˜í™˜í•˜ë©´, ë‹¤ìŒ `ExceptionResolver`ë¥¼ ì°¾ì•„ì„œ ì‹¤í–‰í•œë‹¤. ë§Œì•½ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” `ExceptionResolver`ê°€ ì—†ìœ¼ë©´ ì˜ˆì™¸ ì²˜ë¦¬ê°€ ì•ˆë˜ê³ , ê¸°ì¡´ì— ë°œìƒí•œ ì˜ˆì™¸ë¥¼ ì„œë¸”ë¦¿ ë°–ìœ¼ë¡œ ë˜ì§„ë‹¤.<br/><br/>
#### ExceptionResolver í™œìš©
- ì˜ˆì™¸ ìƒíƒœ ì½”ë“œ ë³€í™˜
  - ì˜ˆì™¸ë¥¼ `response.sendError(xxx)` í˜¸ì¶œë¡œ ë³€ê²½í•´ì„œ ì„œë¸”ë¦¿ì—ì„œ ìƒíƒœ ì½”ë“œì— ë”°ë¥¸ ì˜¤ë¥˜ë¥¼ ì²˜ë¦¬í•˜ë„ë¡ ìœ„ì„í•œë‹¤.
  - ì´í›„ WASëŠ” ì„œë¸”ë¦¿ ì˜¤ë¥˜ í˜ì´ì§€ë¥¼ ì°¾ì•„ì„œ ë‚´ë¶€ í˜¸ì¶œ, ì˜ˆë¥¼ ë“¤ì–´ì„œ ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ ê¸°ë³¸ìœ¼ë¡œ ì„¤ì •í•œ `/error`ê°€ í˜¸ì¶œëœë‹¤.
- ë·° í…œí”Œë¦¿ ì²˜ë¦¬
  - `ModelAndView`ì— ê°’ì„ ì±„ì›Œì„œ ì˜ˆì™¸ì— ë”°ë¥¸ ìƒˆë¡œìš´ ì˜¤ë¥˜ í™”ë©´ ë·° ë Œë”ë§ í•´ì„œ ê³ ê°ì—ê²Œ ì œê³µí•œë‹¤.
- API ì‘ë‹µ ì²˜ë¦¬
  - `response.getWriter().println("hello");`ì²˜ëŸ¼ HTTP ì‘ë‹µ ë°”ë””ì— ì§ì ‘ ë°ì´í„°ë¥¼ ë„£ì–´ì£¼ëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë‹¤. ì—¬ê¸°ì— JSON ìœ¼ë¡œ ì‘ë‹µí•˜ë©´ API ì‘ë‹µ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆë‹¤.<br/><br/>
#### 
`java/hello/exception/WebConfig`
```java
    ...

    @Override
    public void extendHandlerExceptionResolvers(List<HandlerExceptionResolver> resolvers) {
        resolvers.add(new MyHandlerExceptionResolver());
    }

    ...
```
<br/><br/>**Postmanìœ¼ë¡œ ì‹¤í–‰**<br/>
http://localhost:8080/api/members/ex -> HTTP ìƒíƒœ ì½”ë“œ 500<br/>
http://localhost:8080/api/members/bad -> HTTP ìƒíƒœ ì½”ë“œ 400<br/><br/>
# ğŸ” HandlerExceptionResolver í™œìš©
**ì˜ˆì™¸ë¥¼ ì—¬ê¸°ì„œ ë§ˆë¬´ë¦¬í•˜ê¸°**<br/>
ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ WASê¹Œì§€ ì˜ˆì™¸ê°€ ë˜ì ¸ì§€ê³ , WASì—ì„œ ì˜¤ë¥˜ í˜ì´ì§€ ì •ë³´ë¥¼ ì°¾ì•„ì„œ ë‹¤ì‹œ `/error`ë¥¼ í˜¸ì¶œí•˜ëŠ” ê³¼ì •ì€ ìƒê°í•´ë³´ë©´ ë„ˆë¬´ ë³µì¡í•˜ë‹¤.<br/>
`ExceptionResolver`ë¥¼ í™œìš©í•˜ë©´ ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ ë•Œ ì´ëŸ° ë³µì¡í•œ ê³¼ì • ì—†ì´ ì—¬ê¸°ì—ì„œ ë¬¸ì œë¥¼ ê¹”ë”í•˜ê²Œ í•´ê²°í•  ìˆ˜ ìˆë‹¤.<br/><br/>
**ì‚¬ìš©ì ì •ì˜ ì˜ˆì™¸ ì¶”ê°€**<br/>
`java/hello/exception/exception/UserException`
```java
public class UserException extends RuntimeException{

    public UserException() {
        super();
    }

    public UserException(String message) {
        super(message);
    }

    public UserException(String message, Throwable cause) {
        super(message, cause);
    }

    public UserException(Throwable cause) {
        super(cause);
    }

    protected UserException(String message, Throwable cause, boolean enableSuppression, boolean writableStackTrace) {
        super(message, cause, enableSuppression, writableStackTrace);
    }
}
```
<br/><br/>**ApiExceptionController - ì˜ˆì™¸ ì¶”ê°€**<br/>
`java/hello/exception/api/ApiExceptionController`
```java
    @GetMapping("/api/members/{id}")
    public MemberDto getMember(@PathVariable("id") String id) {

        if (id.equals("ex")) {
            throw new RuntimeException("ì˜ëª»ëœ ì‚¬ìš©ì");
        }
        if (id.equals("bad")) {
            throw new IllegalArgumentException("ì˜ëª»ëœ ì…ë ¥ ê°’");
        }
        if (id.equals("user-ex")) {
            throw new UserException("ì‚¬ìš©ì ì˜¤ë¥˜");
        }

        return new MemberDto(id, "hello" + id);
    }
```
http://localhost:8080/api/members/user-ex í˜¸ì¶œ ì‹œ `UserException`ì´ ë°œìƒí•˜ë„ë¡ í•´ë‘ì—ˆë‹¤.<br/><br/>
ì´ì œ ì´ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” `UserHandlerExceptionResolver`ë¥¼ ë§Œë“ ë‹¤.<br/><br/>
`java/hello/exception/resolver/UserHandlerExceptionResolver`
```java
@Slf4j
public class UserHandlerExceptionResolver implements HandlerExceptionResolver {

    private final ObjectMapper objectMapper = new ObjectMapper();
    @Override
    public ModelAndView resolveException(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) {
        try {

            if (ex instanceof UserException) {
                log.info("UserException resolver to 400");
                String acceptHeader = request.getHeader("accept");
                response.setStatus(HttpServletResponse.SC_BAD_REQUEST);

                if ("application/json".equals(acceptHeader)) {
                    Map<String, Object> errorResult = new HashMap<>();
                    errorResult.put("ex", ex.getClass());
                    errorResult.put("message", ex.getMessage());

                    String result = objectMapper.writeValueAsString(errorResult);

                    response.setContentType("application/json");
                    response.setCharacterEncoding("utf-8");
                    response.getWriter().write(result);
                    return new ModelAndView();

                } else {
                    // TEXT/HTML
                    return new ModelAndView("error/500");
                }
            }
        } catch (IOException e) {
            log.info("resolver ex", e);
        }

        return null;
    }
}
```
HTTP ìš”ì²­ í•´ë”ì˜ `ACCEPT` ê°’ì´ `application/json`ì´ë©´ JSONìœ¼ë¡œ ì˜¤ë¥˜ë¥¼ ë‚´ë ¤ì£¼ê³ , ê·¸ ì™¸ ê²½ìš°ì—ëŠ” `error/500`ì— ìˆëŠ” HTML ì˜¤ë¥˜ í˜ì´ì§€ë¥¼ ë³´ì—¬ì¤€ë‹¤.<br/><br/>
**WebConfigì— UserHandlerExceptionResolver ì¶”ê°€**<br/>
`java/hello/exception/WebConfig`
```java
    @Override
    public void extendHandlerExceptionResolvers(List<HandlerExceptionResolver> resolvers) {
        resolvers.add(new MyHandlerExceptionResolver());
        resolvers.add(new UserHandlerExceptionResolver());
    }
```
<br/><br/>**POSTMAN ì‹¤í–‰**<br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/746d672e-b412-4d73-b67c-87d06c45c41e)<br/><br/>
`ExceptionResolver`ë¥¼ ì‚¬ìš©í•˜ë©´ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ `ExceptionResolver`ì—ì„œ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•´ë²„ë¦°ë‹¤.<br/>
ë”°ë¼ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê¹Œì§€ ì˜ˆì™¸ê°€ ì „ë‹¬ë˜ì§€ ì•Šê³ , ìŠ¤í”„ë§ MVCì—ì„œ ì˜ˆì™¸ ì²˜ë¦¬ëŠ” ëì´ ë‚œë‹¤.<br/>
ê²°ê³¼ì ìœ¼ë¡œ WAS ì…ì¥ì—ì„œëŠ” ì •ìƒ ì²˜ë¦¬ê°€ ëœ ê²ƒì´ë‹¤. ì´ë ‡ê²Œ ì˜ˆì™¸ë¥¼ ì´ê³³ì—ì„œ ëª¨ë‘ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ í•µì‹¬ì´ë‹¤.<br/><br/>
ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê¹Œì§€ ì˜ˆì™¸ê°€ ì˜¬ë¼ê°€ë©´ ë³µì¡í•˜ê³  ì§€ì €ë¶„í•˜ê²Œ ì¶”ê°€ í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰ëœë‹¤. ë°˜ë©´ì— `ExceptionResolver`ë¥¼ ì‚¬ìš©í•˜ë©´ ì˜ˆì™¸ì²˜ë¦¬ê°€ ìƒë‹¹íˆ ê¹”ë”í•´ì§„ë‹¤.<br/><br/>
ê·¸ëŸ°ë° ì§ì ‘ `ExceptionResolver`ë¥¼ êµ¬í˜„í•˜ë ¤ê³  í•˜ë‹ˆ ìƒë‹¹íˆ ë³µì¡í•˜ë‹¤. ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” `ExceptionResolver`ë“¤ì„ ì•Œì•„ë³´ì.<br/><br/>
# ğŸ” ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ExceptionResolver1
ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•˜ëŠ” `ExceptionResolver`ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.<br/><br/>
`HandlerExceptionResolverComposite`ì— ë‹¤ìŒ ìˆœì„œë¡œ ë“±ë¡
1. `ExceptionHandlerExceptionResolver`
2. `ResponseStatusExceptionResolver`
3. `DefaultHandlerExceptionResolver` -> ìš°ì„  ìˆœìœ„ê°€ ê°€ì¥ ë‚®ë‹¤.
#### 
**ExceptionHandlerExceptionResolver**<br/>
`@ExceptionHandler`ë¥¼ ì²˜ë¦¬í•œë‹¤. API ì˜ˆì™¸ ì²˜ë¦¬ëŠ” ëŒ€ë¶€ë¶„ ì´ ê¸°ëŠ¥ìœ¼ë¡œ í•´ê²°í•œë‹¤. ë’¤ì—ì„œ ìì„¸íˆ ì„¤ëª…í•œë‹¤.<br/><br/>
**ResponseStatusExceptionResolver**<br/>
HTTP ìƒíƒœ ì½”ë“œë¥¼ ì§€ì •í•´ì¤€ë‹¤.<br/>
ì˜ˆ) `@ResponseStatus(value = HttpStatus.NOT_FOUND)`<br/><br/>
**DefaultHandlerExceptionResolver**<br/>
ìŠ¤í”„ë§ ë‚´ë¶€ ê¸°ë³¸ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•œë‹¤.<br/><br/>
### ResponseStatusExceptionResolver
`ResponseStatusExceptionResolver`ëŠ” ì˜ˆì™¸ì— ë”°ë¼ì„œ HTTP ìƒíƒœ ì½”ë“œë¥¼ ì§€ì •í•´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤.<br/><br/>
ë‹¤ìŒ ë‘ ê°€ì§€ ê²½ìš°ë¥¼ ì²˜ë¦¬í•œë‹¤.
- `@ResponseStatus`ê°€ ë‹¬ë ¤ìˆëŠ” ì˜ˆì™¸
- `ResponseStatusException` ì˜ˆì™¸<br/><br/>
#### @ResponseStatus
`java/hello/exception/exception/BadRequestException`
```java
@ResponseStatus(code = HttpStatus.BAD_REQUEST, reason = "ì˜ëª»ëœ ìš”ì²­ ì˜¤ë¥˜")
public class BadRequestException extends RuntimeException{
}
```
ì˜ˆì™¸ì— ë‹¤ìŒê³¼ ê°™ì´ `@ResponseStatus` ì• ë…¸í…Œì´ì…˜ì„ ì ìš©í•˜ë©´ HTTP ìƒíƒœ ì½”ë“œë¥¼ ë³€ê²½í•´ì¤€ë‹¤.<br/><br/>
`BadRequestException` ì˜ˆì™¸ê°€ ì»¨íŠ¸ë¡¤ëŸ¬ ë°–ìœ¼ë¡œ ë„˜ì–´ê°€ë©´ `ResponseStatusExceptionResolver` ì˜ˆì™¸ê°€ í•´ë‹¹ ì• ë…¸í…Œì´ì…˜ì„ í™•ì¸í•´ì„œ ì˜¤ë¥˜ ì½”ë“œë¥¼ `HttpStatus.BAD_REQUEST`(400)ë¡œ ë³€ê²½í•˜ê³ , ë©”ì‹œì§€ë„ ë‹´ëŠ”ë‹¤.<br/><br/>
`ResponseStatusExceptionResolver` ì½”ë“œë¥¼ í™•ì¸í•´ë³´ë©´ ê²°êµ­ `response.sendError(statusCode, resolvedReason)`ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/>
`sendError(400)`ë¥¼ í˜¸ì¶œí–ˆê¸° ë•Œë¬¸ì— WASì—ì„œ ë‹¤ì‹œ ì˜¤ë¥˜ í˜ì´ì§€(`/error`)ë¥¼ ë‚´ë¶€ ìš”ì²­í•œë‹¤.<br/><br/>
`java/hello/exception/api/ApiExceptionController`
```java
    @GetMapping("/api/response-status-ex1")
    public String responseStatusEx1() {
        throw new BadRequestException();
    }
```
<br/><br/>**POSTMAN ì‹¤í–‰**<br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/277c66e9-d30f-45f4-a240-16c843e958ea)<br/><br/>
**ë©”ì‹œì§€ ê¸°ëŠ¥**<br/>
`reason`ì„ `MessageSource`ì—ì„œ ì°¾ëŠ” ê¸°ëŠ¥ë„ ì œê³µí•œë‹¤.<br/><br/>
`java/hello/exception/exception/BadRequestException`
```java
@ResponseStatus(code = HttpStatus.BAD_REQUEST, reason = "error.bad")
public class BadRequestException extends RuntimeException{
}
```
`resources/messages.properties`
```properties
error.bad=ì˜ëª»ëœ ìš”ì²­ ì˜¤ë¥˜ì…ë‹ˆë‹¤. ë©”ì‹œì§€ ì‚¬ìš©
```
<br/><br/>**POSTMAN ì‹¤í–‰**<br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/6417606e-4e46-4add-a6aa-0a3a308b6b63)<br/><br/>
#### ResponseStatusException
`@ResponseStatus`ëŠ” ê°œë°œìê°€ ì§ì ‘ ë³€ê²½í•  ìˆ˜ ì—†ëŠ” ì˜ˆì™¸ì—ëŠ” ì ìš©í•  ìˆ˜ ì—†ë‹¤.(ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì˜ˆì™¸)<br/>
ì¶”ê°€ë¡œ ì• ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì¡°ê±´ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ë³€ê²½í•˜ëŠ” ê²ƒë„ ì–´ë µë‹¤. ì´ë•ŒëŠ” `ResponseStatusException` ì˜ˆì™¸ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.<br/><br/>
`java/hello/exception/api/ApiExceptionController`
```java
    @GetMapping("/api/response-status-ex2")
    public String responseStatusEx2() {
        throw new ResponseStatusException(HttpStatus.NOT_FOUND, "error.bad", new IllegalArgumentException());
    }
```
<br/><br/>**POSTMAN ì‹¤í–‰**<br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/b5d7cbf2-b7ef-4488-86de-5adc6826f135)<br/><br/>
# ğŸ” ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ExceptionResolver2
### DefaultHandlerExceptionResolver
`DefaultHandlerExceptionResolver`ëŠ” ìŠ¤í”„ë§ ë‚´ë¶€ì—ì„œ ë°œìƒí•˜ëŠ” ìŠ¤í”„ë§ ì˜ˆì™¸ë¥¼ í•´ê²°í•œë‹¤.<br/>
ëŒ€í‘œì ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ë°”ì¸ë”© ì‹œì ì— íƒ€ì…ì´ ë§ì§€ ì•Šìœ¼ë©´ ë‚´ë¶€ì—ì„œ `TypeMismatchException`ì´ ë°œìƒí•˜ëŠ”ë°, `DefaultHandlerExceptionResolver`ëŠ” ì´ê²ƒì„ 500 ì˜¤ë¥˜ê°€ ì•„ë‹ˆë¼ HTTP ìƒíƒœ ì½”ë“œ 400 ì˜¤ë¥˜ë¡œ ë³€ê²½í•œë‹¤.<br/><br/>
`java/hello/exception/api/ApiExceptionController`
```java
    @GetMapping("/api/default-handler-ex")
    public String defaultException(@RequestParam Integer data) {
        return "ok";
    }
```
`Integer data`ì— ë¬¸ìë¥¼ ì…ë ¥í•˜ë©´ ë‚´ë¶€ì—ì„œ `TypeMismatchException`ì´ ë°œìƒí•œë‹¤.<br/><br/>
<br/><br/>**POSTMAN ì‹¤í–‰**<br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/7a7a5367-1549-4cae-8ba1-7c883708a954)<br/><br/>
**ì½”ë“œ í™•ì¸**<br/>
`DefaultHandlerExceptionResolver.handleTypeMismatch`ë¥¼ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/>
`response.sendError(HttpServletResponse.SC_BAD_REQUEST)` (400)<br/><br/>
ê²°êµ­ `response.sendError()`ë¥¼ í†µí•´ì„œ ë¬¸ì œë¥¼ í•´ê²°í•œë‹¤.<br/><br/>
# ğŸ” @ExceptionHandler
**API ì˜ˆì™¸ì²˜ë¦¬ì˜ ì–´ë ¤ìš´ ì **
- `HandlerExceptionResolver`ë¥¼ ë– ì˜¬ë ¤ ë³´ë©´ `ModelAndView`ë¥¼ ë°˜í™˜í•´ì•¼ í–ˆë‹¤. ì´ê²ƒì€ API ì‘ë‹µì—ëŠ” í•„ìš”í•˜ì§€ ì•Šë‹¤.
- API ì‘ë‹µì„ ìœ„í•´ì„œ `HttpServletResponse`ì— ì§ì ‘ ì‘ë‹µ ë°ì´í„°ë¥¼ ë„£ì–´ì£¼ì—ˆë‹¤. ì´ê²ƒì€ ë§¤ìš° ë¶ˆí¸í•˜ë‹¤.
- íŠ¹ì • ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œë§Œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ë¥¼ ë³„ë„ë¡œ ì²˜ë¦¬í•˜ê¸° ì–´ë µë‹¤.<br/><br/>
### @ExceptionHandler
ìŠ¤í”„ë§ì€ API ì˜ˆì™¸ ì²˜ë¦¬ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `@ExceptionHandler`ë¼ëŠ” ì• ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ë§¤ìš° í¸ë¦¬í•œ ì˜ˆì™¸ ì²˜ë¦¬ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ”ë°, ì´ê²ƒì´ ë°”ë¡œ `ExceptionHandlerExceptionResolver`ì´ë‹¤.<br/>
ìŠ¤í”„ë§ì€ `ExceptionHandlerExceptionResolver`ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•˜ê³ , ê¸°ë³¸ìœ¼ë¡œ ì œê³µí•˜ëŠ” `ExceptionResolver` ì¤‘ì— ìš°ì„ ìˆœìœ„ë„ ê°€ì¥ ë†’ë‹¤. ì‹¤ë¬´ì—ì„œ API ì˜ˆì™¸ ì²˜ë¦¬ëŠ” ëŒ€ë¶€ë¶„ ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•œë‹¤.<br/><br/>
`java/hello/exception/exhandler/ErrorResult`
```java
@Data
@AllArgsConstructor
public class ErrorResult {
    private String code;
    private String message;
}
```
ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ ë•Œ API ì‘ë‹µìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê°ì²´ë¥¼ ì •ì˜í•œë‹¤.<br/><br/>
`java/hello/exception/api/ApiExceptionV2Controller`
```java
@Slf4j
@RestController
public class ApiExceptionV2Controller {

    @ResponseStatus(HttpStatus.BAD_REQUEST)
    @ExceptionHandler(IllegalArgumentException.class)
    public ErrorResult illegalExHandler(IllegalArgumentException e) {
        log.info("[exceptionHandler] ex", e);
        return new ErrorResult("BAD", e.getMessage());
    }

    @ExceptionHandler
    public ResponseEntity<ErrorResult> userHandler(UserException e) {
        log.error("[exceptionHandler] ex", e);
        ErrorResult errorResult = new ErrorResult("USER-EX", e.getMessage());
        return new ResponseEntity(errorResult, HttpStatus.BAD_REQUEST);
    }

    @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)
    @ExceptionHandler
    public ErrorResult exHandler(Exception e) {
        log.error("[exceptionHandler] ex", e);
        return new ErrorResult("EX", "ë‚´ë¶€ ì˜¤ë¥˜");
    }

    @GetMapping("/api2/members/{id}")
    public MemberDto getMember(@PathVariable("id") String id) {

        if (id.equals("ex")) {
            throw new RuntimeException("ì˜ëª»ëœ ì‚¬ìš©ì");
        }
        if (id.equals("bad")) {
            throw new IllegalArgumentException("ì˜ëª»ëœ ì…ë ¥ ê°’");
        }
        if (id.equals("user-ex")) {
            throw new UserException("ì‚¬ìš©ì ì˜¤ë¥˜");
        }

        return new MemberDto(id, "hello" + id);
    }

    @Data
    @AllArgsConstructor
    static class MemberDto {
        private String memberId;
        private String name;
    }
}
```
@ExceptionHandler ì• ë…¸í…Œì´ì…˜ì„ ì„ ì–¸í•˜ê³ , í•´ë‹¹ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì²˜ë¦¬í•˜ê³  ì‹¶ì€ ì˜ˆì™¸ë¥¼ ì§€ì •í•´ì£¼ë©´ ëœë‹¤.<br/>
í•´ë‹¹ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ì´ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤. ì§€ì •í•œ ì˜ˆì™¸ ë˜ëŠ” ê·¸ ì˜ˆì™¸ì˜ ìì‹ í´ë˜ìŠ¤ëŠ” ëª¨ë‘ ì¡ì„ ìˆ˜ ìˆë‹¤.<br/><br/>
#### ìš°ì„ ìˆœìœ„
ìŠ¤í”„ë§ì˜ ìš°ì„ ìˆœìœ„ëŠ” í•­ìƒ ìì„¸í•œ ê²ƒì´ ìš°ì„ ê¶Œì„ ê°€ì§„ë‹¤.
```java
@ExceptionHandler(ë¶€ëª¨ì˜ˆì™¸.class)
public String ë¶€ëª¨ì˜ˆì™¸ì²˜ë¦¬()(ë¶€ëª¨ì˜ˆì™¸ e) {}

@ExceptionHandler(ìì‹ì˜ˆì™¸.class)
public String ìì‹ì˜ˆì™¸ì²˜ë¦¬()(ìì‹ì˜ˆì™¸ e) {}
```
`ìì‹ì˜ˆì™¸`ê°€ ë°œìƒí•˜ë©´ `ë¶€ëª¨ì˜ˆì™¸ì²˜ë¦¬()`, `ìì‹ì˜ˆì™¸ì²˜ë¦¬()` ë‘˜ë‹¤ í˜¸ì¶œ ëŒ€ìƒì´ ëœë‹¤.<br/>
ê·¸ëŸ°ë° ë‘˜ ì¤‘ ë” ìì„¸í•œ ê²ƒì´ ìš°ì„ ê¶Œì„ ê°€ì§€ë¯€ë¡œ `ìì‹ì˜ˆì™¸ì²˜ë¦¬()`ê°€ í˜¸ì¶œëœë‹¤.<br/>
ë¬¼ë¡  `ë¶€ëª¨ì˜ˆì™¸`ê°€ í˜¸ì¶œë˜ë©´ `ë¶€ëª¨ì˜ˆì™¸ì²˜ë¦¬()`ë§Œ í˜¸ì¶œ ëŒ€ìƒì´ ë˜ë¯€ë¡œ `ë¶€ëª¨ì˜ˆì™¸ì²˜ë¦¬()`ê°€ í˜¸ì¶œëœë‹¤.<br/><br/>
#### ë‹¤ì–‘í•œ ì˜ˆì™¸
ë‹¤ìŒê³¼ ê°™ì´ ë‹¤ì–‘í•œ ì˜ˆì™¸ë¥¼ í•œë²ˆì— ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.
```java
@ExceptionHandler({AException.class, BException.class})
public String ex(Exception e) {
    log.info("exception e", e);
}
```
<br/><br/>
#### ì˜ˆì™¸ ìƒëµ
`@ExceptionHandler`ì— ì˜ˆì™¸ë¥¼ ìƒëµí•  ìˆ˜ ìˆë‹¤. ìƒëµí•˜ë©´ ë©”ì„œë“œ íŒŒë¼ë¯¸í„°ì˜ ì˜ˆì™¸ê°€ ì§€ì •ëœë‹¤.
```java
@ExceptionHandler
public ResponseEntity<ErrorResult> userExHandle(UserException e) {}
```
<br/><br/>
#### íŒŒë¦¬ë¯¸í„°ì™€ ì‘ë‹µ
`@ExceptionHandler`ì—ëŠ” ë§ˆì¹˜ ìŠ¤í”„ë§ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ íŒŒë¼ë¯¸í„° ì‘ë‹µì²˜ëŸ¼ ë‹¤ì–‘í•œ íŒŒë¼ë¯¸í„°ì™€ ì‘ë‹µì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.<br/>
ìì„¸í•œ íŒŒë¼ë¯¸í„°ì™€ ì‘ë‹µì€ ë‹¤ìŒ ê³µì‹ ë©”ë‰´ì–¼ì„ ì°¸ê³ í•˜ì.<br/>
https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-controller/ann-exceptionhandler.html#mvc-ann-exceptionhandler-args<br/><br/>
<br/><br/>**POSTMAN ì‹¤í–‰**<br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/90d29305-f7e1-4784-89a5-3ccc93974a75)<br/><br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/46848c1f-9fbc-48ef-8d68-f57714bb9983)<br/><br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/a1f86efb-ad97-4dca-912d-318540beafcb)<br/><br/>
**ì‹¤í–‰ íë¦„**
- ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í˜¸ì¶œí•œ ê²°ê³¼ `IllegalArgumentException` ì˜ˆì™¸ê°€ ì»¨íŠ¸ë¡¤ëŸ¬ ë°–ìœ¼ë¡œ ë˜ì ¸ì§„ë‹¤.
- ì˜ˆì™¸ê°€ ë°œìƒí–ˆìœ¼ë¡œ `ExceptionResolver`ê°€ ì‘ë™í•œë‹¤. ê°€ì¥ ìš°ì„ ìˆœìœ„ê°€ ë†’ì€ `ExceptionHandlerExceptionResolver`ê°€ ì‹¤í–‰ëœë‹¤.
- `ExceptionHandlerExceptionResolver`ëŠ” í•´ë‹¹ ì»¨íŠ¸ë¡¤ëŸ¬ì— `IllegalArgumentException`ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” `@ExceptionHandler`ê°€ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤.
- `illegalExHandle()`ë¥¼ ì‹¤í–‰í•œë‹¤. `@RestController`ì´ë¯€ë¡œ `illegalExHandle()`ì—ë„ `@ResponseBody`ê°€ ì ìš©ëœë‹¤. ë”°ë¼ì„œ HTTP ì»¨ë²„í„°ê°€ ì‚¬ìš©ë˜ê³ , ì‘ë‹µì´ ë‹¤ìŒê³¼ ê°™ì€ JSONìœ¼ë¡œ ë°˜í™˜ëœë‹¤.
- `@ResponseStatus(HttpStatus.BAD_REQUEST)`ë¥¼ ì§€ì •í–ˆìœ¼ë¯€ë¡œ HTTP ìƒíƒœ ì½”ë“œ 400ìœ¼ë¡œ ì‘ë‹µí•œë‹¤.
<br/><br/>
# ğŸ” @ControllerAdvice
`@ExceptionHandler`ë¥¼ ì‚¬ìš©í•´ì„œ ì˜ˆì™¸ë¥¼ ê¹”ë”í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆì§€ë§Œ, ì •ìƒ ì½”ë“œì™€ ì˜ˆì™¸ ì²˜ë¦¬ ì½”ë“œê°€ í•˜ë‚˜ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ì— ì„ì—¬ ìˆë‹¤.<br/>
`@ControllerAdvice` ë˜ëŠ” `@RestControllerAdvice`ë¥¼ ì‚¬ìš©í•˜ë©´ ë‘˜ì„ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤.<br/><br/>
`java/hello/exception/exhandler/advice/ExControllerAdvice`
```java
@Slf4j
@RestControllerAdvice
public class ExControllerAdvice {

    @ResponseStatus(HttpStatus.BAD_REQUEST)
    @ExceptionHandler(IllegalArgumentException.class)
    public ErrorResult illegalExHandler(IllegalArgumentException e) {
        log.info("[exceptionHandler] ex", e);
        return new ErrorResult("BAD", e.getMessage());
    }

    @ExceptionHandler
    public ResponseEntity<ErrorResult> userHandler(UserException e) {
        log.error("[exceptionHandler] ex", e);
        ErrorResult errorResult = new ErrorResult("USER-EX", e.getMessage());
        return new ResponseEntity(errorResult, HttpStatus.BAD_REQUEST);
    }

    @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)
    @ExceptionHandler
    public ErrorResult exHandler(Exception e) {
        log.error("[exceptionHandler] ex", e);
        return new ErrorResult("EX", "ë‚´ë¶€ ì˜¤ë¥˜");
    }
}
```
<br/><br/>`java/hello/exception/api/ApiExceptionV2Controller`
```java
@Slf4j
@RestController
public class ApiExceptionV2Controller {

    @GetMapping("/api2/members/{id}")
    public MemberDto getMember(@PathVariable("id") String id) {

        if (id.equals("ex")) {
            throw new RuntimeException("ì˜ëª»ëœ ì‚¬ìš©ì");
        }
        if (id.equals("bad")) {
            throw new IllegalArgumentException("ì˜ëª»ëœ ì…ë ¥ ê°’");
        }
        if (id.equals("user-ex")) {
            throw new UserException("ì‚¬ìš©ì ì˜¤ë¥˜");
        }

        return new MemberDto(id, "hello" + id);
    }

    @Data
    @AllArgsConstructor
    static class MemberDto {
        private String memberId;
        private String name;
    }
}
```
**@ControllerAdvice**
- `@ControllerAdvice`ëŠ” ëŒ€ìƒìœ¼ë¡œ ì§€ì •í•œ ì—¬ëŸ¬ ì»¨íŠ¸ë¡¤ëŸ¬ì— `@ExceptionHandler`, `@InitBinder` ê¸°ëŠ¥ì„ ë¶€ì—¬í•´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤.
- `@ControllerAdvice`ì— ëŒ€ìƒì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ì— ì ìš©ëœë‹¤. (ê¸€ë¡œë²Œ ì ìš©)
- `@RestControllerAdvice`ëŠ” `@ControllerAdvice`ì™€ ê°™ê³ , `@ResponseBody`ê°€ ì¶”ê°€ë˜ì–´ ìˆë‹¤.
- `@Controller`, `@RestController`ì˜ ì°¨ì´ì™€ ê°™ë‹¤.
#### 
**ëŒ€ìƒ ì»¨íŠ¸ë¡¤ëŸ¬ ì§€ì • ë°©ë²•**
```java
// Target all Controllers annotated with @RestController
@ControllerAdvice(annotations = RestController.class)
public class ExampleAdvice1 {}

// Target all Controllers within specific packages
@ControllerAdvice("org.example.controllers")
public class ExampleAdvice2 {}

// Target all Controllers assignable to specific classes
@ControllerAdvice(assignableTypes = {ControllerInterface.class,
AbstractController.class})
public class ExampleAdvice3 {}
```
ìŠ¤í”„ë§ ê³µì‹ ë¬¸ì„œ<br/>
https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-controller/ann-advice.html