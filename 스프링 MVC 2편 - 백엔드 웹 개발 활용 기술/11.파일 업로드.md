# ğŸ“– íŒŒì¼ ì—…ë¡œë“œ
<br/><br/>
# ğŸ” íŒŒì¼ ì—…ë¡œë“œ ì†Œê°œ
### HTML í¼ ì „ì†¡ ë°©ì‹
- `application/x-www-form-urlencoded`
- `multipart/form-data`
<br/><br/>
#### application/x-www-form-urlencoded ë°©ì‹
![image](https://github.com/jang9205/spring_study/assets/123082616/7b204b50-6edb-4138-85d8-233837d05d33)<br/><br/>
`application/x-www-form-urlencoded` ë°©ì‹ì€ HTML í¼ ë°ì´í„°ë¥¼ ì„œë²„ë¡œ ì „ì†¡í•˜ëŠ” ê°€ì¥ ê¸°ë³¸ì ì¸ ë°©ë²•ì´ë‹¤.<br/>
Form íƒœê·¸ì— ë³„ë„ì˜ `enctype` ì˜µì…˜ì´ ì—†ìœ¼ë©´ ì›¹ ë¸Œë¼ìš°ì €ëŠ” ìš”ì²­ HTTP ë©”ì‹œì§€ì˜ í—¤ë”ì— ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•œë‹¤.<br/><br/>
```
Content-Type: application/x-www-form-urlencoded
```
ê·¸ë¦¬ê³  í¼ì— ì…ë ¥í•œ ì „ì†¡í•  í•­ëª©ì„ HTTP Bodyì— ë¬¸ìë¡œ `username=kim&age=20`ì™€ ê°™ì´ `&`ë¡œ êµ¬ë¶„í•´ì„œ ì „ì†¡í•œë‹¤.<br/><br/>
íŒŒì¼ì„ ì—…ë¡œë“œ í•˜ë ¤ë©´ íŒŒì¼ì€ ë¬¸ìê°€ ì•„ë‹ˆë¼ ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ ì „ì†¡í•´ì•¼ í•œë‹¤.<br/>
ë¬¸ìë¥¼ ì „ì†¡í•˜ëŠ” ì´ ë°©ì‹ìœ¼ë¡œ íŒŒì¼ì„ ì „ì†¡í•˜ê¸°ëŠ” ì–´ë µë‹¤.<br/>
ê·¸ë¦¬ê³  ë˜ í•œê°€ì§€ ë¬¸ì œê°€ ë” ìˆëŠ”ë°, ë³´í†µ í¼ì„ ì „ì†¡í•  ë•Œ íŒŒì¼ë§Œ ì „ì†¡í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ëŠ” ì ì´ë‹¤. ë‹¤ìŒ ì˜ˆë¥¼ ë³´ì.<br/><br/>
```
- ì´ë¦„
- ë‚˜ì´
- ì²¨ë¶€íŒŒì¼
```
ì—¬ê¸°ì—ì„œ ì´ë¦„ê³¼ ë‚˜ì´ë„ ì „ì†¡í•´ì•¼ í•˜ê³ , ì²¨ë¶€íŒŒì¼ë„ í•¨ê»˜ ì „ì†¡í•´ì•¼ í•œë‹¤.<br/>
ë¬¸ì œëŠ” ì´ë¦„ê³¼ ë‚˜ì´ëŠ” ë¬¸ìë¡œ ì „ì†¡í•˜ê³ , ì²¨ë¶€íŒŒì¼ì€ ë°”ì´ë„ˆë¦¬ë¡œ ì „ì†¡í•´ì•¼ í•œë‹¤ëŠ” ì ì´ë‹¤. **ë¬¸ìì™€ ë°”ì´ë„ˆë¦¬ë¥¼ ë™ì‹œì— ì „ì†¡**í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ë‹¤.<br/><br/>
ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ HTTPëŠ” `multipart/form-data`ë¼ëŠ” ì „ì†¡ ë°©ì‹ì„ ì œê³µí•œë‹¤.<br/><br/>
#### multipart/form-data ë°©ì‹
![image](https://github.com/jang9205/spring_study/assets/123082616/f1c18b0b-1bbf-42fe-a080-5dea5be6dda0)<br/><br/>
ì´ ë°©ì‹ì„ ì‚¬ìš©í•˜ë ¤ë©´ Form íƒœê·¸ì— ë³„ë„ì˜ `enctype="multipart/form-data"`ë¥¼ ì§€ì •í•´ì•¼ í•œë‹¤.<br/>
`multipart/form-data` ë°©ì‹ì€ ë‹¤ë¥¸ ì¢…ë¥˜ì˜ ì—¬ëŸ¬ íŒŒì¼ê³¼ í¼ì˜ ë‚´ìš© í•¨ê»˜ ì „ì†¡í•  ìˆ˜ ìˆë‹¤.<br/><br/>
í¼ì˜ ì…ë ¥ ê²°ê³¼ë¡œ ìƒì„±ëœ HTTP ë©”ì‹œì§€ë¥¼ ë³´ë©´ ê°ê°ì˜ ì „ì†¡ í•­ëª©ì´ êµ¬ë¶„ì´ ë˜ì–´ìˆë‹¤.<br/>
`Content-Disposition`ì´ë¼ëŠ” í•­ëª©ë³„ í—¤ë”ê°€ ì¶”ê°€ë˜ì–´ ìˆê³  ì—¬ê¸°ì— ë¶€ê°€ ì •ë³´ê°€ ìˆë‹¤.<br/>
ì˜ˆì œì—ì„œëŠ” `username`, `age`, `file1`ì´ ê°ê° ë¶„ë¦¬ë˜ì–´ ìˆë‹¤.<br/>
í¼ì˜ ì¼ë°˜ ë°ì´í„°ëŠ” ê° í•­ëª©ë³„ë¡œ ë¬¸ìê°€ ì „ì†¡ë˜ê³ , íŒŒì¼ì˜ ê²½ìš° íŒŒì¼ ì´ë¦„ê³¼ Content-Typeì´ ì¶”ê°€ë˜ê³  ë°”ì´ë„ˆë¦¬ ë°ì´í„°ê°€ ì „ì†¡ëœë‹¤.<br/><br/>
`multipart/form-data`ëŠ” ì´ë ‡ê²Œ ê°ê°ì˜ í•­ëª©ì„ êµ¬ë¶„í•´ì„œ, í•œë²ˆì— ì „ì†¡í•˜ëŠ” ê²ƒì´ë‹¤.<br/><br/>
`multipart/form-data`ëŠ” `application/x-www-form-urlencoded`ì™€ ë¹„êµí•´ì„œ ë§¤ìš° ë³µì¡í•˜ê³  ê°ê°ì˜ **ë¶€ë¶„**(`Part`)ìœ¼ë¡œ ë‚˜ëˆ„ì–´ì ¸ ìˆë‹¤.<br/><br/>
# ğŸ” í”„ë¡œì íŠ¸ ìƒì„±
[ìŠ¤í”„ë§ ë¶€íŠ¸ ìŠ¤íƒ€í„°](https://start.spring.io/)ì—ì„œ ìŠ¤í”„ë§ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•œë‹¤.<br/><br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/cad97c92-f28e-44a1-9279-93aaec68d637)<br/><br/>
# ğŸ” ì„œë¸”ë¦¿ê³¼ íŒŒì¼ ì—…ë¡œë“œ1
`java/hello/upload/controller/ServletUploadControllerV1`
```java
@Slf4j
@Controller
@RequestMapping("/servlet/v1")
public class ServletUploadControllerV1 {

    @GetMapping("/upload")
    public String newFile() {
        return "upload-form";
    }

    @PostMapping("/upload")
    public String saveFileV1(HttpServletRequest request) throws ServletException, IOException {
        log.info("request={}", request);

        String itemName = request.getParameter("itemName");
        log.info("itemName={}", itemName);

        Collection<Part> parts = request.getParts();
        log.info("parts={}", parts);

        return "upload-form";
    }
}
```
`request.getParts()`: `multipart/form-data` ì „ì†¡ ë°©ì‹ì—ì„œ ê°ê° ë‚˜ëˆ„ì–´ì§„ ë¶€ë¶„ì„ ë°›ì•„ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/><br/>
`resources/templates/upload-form.html`
```html
...
<div class="container">

    <div class="py-5 text-center">
        <h2>ìƒí’ˆ ë“±ë¡ í¼</h2>
    </div>

    <h4 class="mb-3">ìƒí’ˆ ì…ë ¥</h4>

    <form th:action method="post" enctype="multipart/form-data">
        <ul>
            <li>ìƒí’ˆëª… <input type="text" name="itemName"></li>
            <li>íŒŒì¼<input type="file" name="file" ></li>
        </ul>
        <input type="submit"/>
    </form>

</div> <!-- /container -->
...
```
<br/><br/>`resources/application.properties`
```properties
logging.level.org.apache.coyote.http11=debug
```
ì´ ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ HTTP ìš”ì²­ ë©”ì‹œì§€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/><br/>
**ì‹¤í–‰**<br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/cd59f2ab-a407-43b4-90bc-c0328b1d5d8e)<br/><br/>
**ê²°ê³¼ ë¡œê·¸**
```
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryp3isAiz1DYIdAPNG

------WebKitFormBoundaryp3isAiz1DYIdAPNG
Content-Disposition: form-data; name="itemName"

itemA
------WebKitFormBoundaryp3isAiz1DYIdAPNG
Content-Disposition: form-data; name="file"; filename="sign.png"
Content-Type: image/png

Â‰PNG...
```
ì‹¤í–‰í•´ë³´ë©´ `logging.level.org.apache.coyote.http11` ì˜µì…˜ì„ í†µí•œ ë¡œê·¸ì—ì„œ `multipart/form-data` ë°©ì‹ìœ¼ë¡œ ì „ì†¡ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/><br/>
### ë©€í‹°íŒŒíŠ¸ ì‚¬ìš© ì˜µì…˜
#### ì—…ë¡œë“œ ì‚¬ì´ì¦ˆ ì œí•œ
```
spring.servlet.multipart.max-file-size=1MB
spring.servlet.multipart.max-request-size=10MB
```
í° íŒŒì¼ì„ ë¬´ì œí•œ ì—…ë¡œë“œí•˜ê²Œ ë‘˜ ìˆ˜ëŠ” ì—†ìœ¼ë¯€ë¡œ ì—…ë¡œë“œ ì‚¬ì´ì¦ˆë¥¼ ì œí•œí•  ìˆ˜ ìˆë‹¤.<br/>
ì‚¬ì´ì¦ˆë¥¼ ë„˜ìœ¼ë©´ ì˜ˆì™¸(`SizeLimitExceededException`)ê°€ ë°œìƒí•œë‹¤.
- max-file-size : íŒŒì¼ í•˜ë‚˜ì˜ ìµœëŒ€ ì‚¬ì´ì¦ˆ, ê¸°ë³¸ 1MB
- max-request-size : ë©€í‹°íŒŒíŠ¸ ìš”ì²­ í•˜ë‚˜ì— ì—¬ëŸ¬ íŒŒì¼ì„ ì—…ë¡œë“œ í•  ìˆ˜ ìˆëŠ”ë° ê·¸ ì „ì²´ í•©, ê¸°ë³¸ 10MB
<br/><br/>
#### spring.servlet.multipart.enabled ë„ê¸°
```
spring.servlet.multipart.enabled=false
```
<br/><br/>**ê²°ê³¼ ë¡œê·¸**
```
request=org.apache.catalina.connector.RequestFacade@xxx
itemName=null
parts=[]
```
`spring.servlet.multipart.enabled` ì˜µì…˜ì„ ë„ë©´ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆëŠ” ë©€í‹°íŒŒíŠ¸ì™€ ê´€ë ¨ëœ ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤.<br/>
ê·¸ë˜ì„œ ê²°ê³¼ ë¡œê·¸ë¥¼ ë³´ë©´ `request.getParameter("itemName")`, `request.getParts()`ì˜ ê²°ê³¼ê°€ ë¹„ì–´ìˆë‹¤.<br/><br/>
#### spring.servlet.multipart.enabled ì¼œê¸°
```
spring.servlet.multipart.enabled=true (ê¸°ë³¸ true)
```
ì´ ì˜µì…˜ì„ ì¼œë©´ ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆì—ê²Œ ë©€í‹°íŒŒíŠ¸ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ë¼ê³  ì„¤ì •í•œë‹¤.<br/><br/>
**ê²°ê³¼ ë¡œê·¸**
```
request=org.springframework.web.multipart.support.StandardMultipartHttpServletRequest
itemName=itemA
parts=[ApplicationPart1, ApplicationPart2]
```
ë¡œê·¸ë¥¼ ë³´ë©´ `HttpServletRequest` ê°ì²´ê°€ `RequestFacade` -> `StandardMultipartHttpServletRequest`ë¡œ ë³€í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/><br/>
# ğŸ” ì„œë¸”ë¦¿ê³¼ íŒŒì¼ ì—…ë¡œë“œ2
íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë ¤ë©´ ì‹¤ì œ íŒŒì¼ì´ ì €ì¥ë˜ëŠ” ê²½ë¡œê°€ í•„ìš”í•˜ë‹¤.<br/><br/>
í•´ë‹¹ ê²½ë¡œì— ì‹¤ì œ í´ë”ë¥¼ ë§Œë“¤ì–´ë‘ê³ , ë‹¤ìŒì— ë§Œë“¤ì–´ì§„ ê²½ë¡œë¥¼ ì…ë ¥í•´ë‘ì.<br/><br/>
`resources/application.properties`
```properties
file.dir=D:/study/file/
```
<br/><br/>`java/hello/upload/controller/ServletUploadControllerV2`
```java
@Slf4j
@Controller
@RequestMapping("/servlet/v2")
public class ServletUploadControllerV2 {

    @Value("${file.dir}")
    private String fileDir;

    @GetMapping("/upload")
    public String newFile() {
        return "upload-form";
    }

    @PostMapping("/upload")
    public String saveFileV1(HttpServletRequest request) throws ServletException, IOException {
        log.info("request={}", request);

        String itemName = request.getParameter("itemName");
        log.info("itemName={}", itemName);

        Collection<Part> parts = request.getParts();
        log.info("parts={}", parts);

        for (Part part : parts) {
            log.info("==== PART ====");
            log.info("name={}", part.getName());
            Collection<String> headerNames = part.getHeaderNames();
            for (String headerName : headerNames) {
                log.info("header {}: {}", headerName, part.getHeader(headerName));
            }
            //í¸ì˜ ë©”ì„œë“œ
            //content-disposition; filename
            log.info("submittedFilename={}", part.getSubmittedFileName());
            log.info("size={}", part.getSize());    //part body size

            //ë°ì´í„° ì½ê¸°
            InputStream inputStream = part.getInputStream();
            String body = StreamUtils.copyToString(inputStream, StandardCharsets.UTF_8);
            log.info("body={}", body);

            //íŒŒì¼ì— ì €ì¥í•˜ê¸°
            if (StringUtils.hasText(part.getSubmittedFileName())) {
                String fullPath = fileDir + part.getSubmittedFileName();
                log.info("íŒŒì¼ ì €ì¥ fullPath={}", fullPath);
                part.write(fullPath);
            }
        }

        return "upload-form";
    }
}
```
`application.properties`ì—ì„œ ì„¤ì •í•œ `file.dir`ì˜ ê°’ì„ ì£¼ì…í•œë‹¤.<br/><br/>
ë©€í‹°íŒŒíŠ¸ í˜•ì‹ì€ ì „ì†¡ ë°ì´í„°ë¥¼ í•˜ë‚˜í•˜ë‚˜ ê°ê° ë¶€ë¶„(`Part`)ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì „ì†¡í•œë‹¤. `parts`ì—ëŠ” ì´ë ‡ê²Œ ë‚˜ëˆ„ì–´ì§„ ë°ì´í„°ê°€ ê°ê° ë‹´ê¸´ë‹¤.<br/>
ì„œë¸”ë¦¿ì´ ì œê³µí•˜ëŠ” `Part`ëŠ” ë©€í‹°íŒŒíŠ¸ í˜•ì‹ì„ í¸ë¦¬í•˜ê²Œ ì½ì„ ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ë©”ì„œë“œë¥¼ ì œê³µí•œë‹¤.<br/><br/>
**Part ì£¼ìš” ë©”ì„œë“œ**<br/>
`part.getSubmittedFileName()`: í´ë¼ì´ì–¸íŠ¸ê°€ ì „ë‹¬í•œ íŒŒì¼ëª…<br/>
`part.getInputStream()`: Partì˜ ì „ì†¡ ë°ì´í„°ë¥¼ ì½ì„ ìˆ˜ ìˆë‹¤.<br/>
`part.write(...)`: Partë¥¼ í†µí•´ ì „ì†¡ëœ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆë‹¤.<br/><br/>
**ì‹¤í–‰**<br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/82ea75dd-ed46-4ca7-8e56-e2db68f83391)<br/><br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/e0955513-b0bf-490d-8568-6e3d2cd012cc)<br/>
íŒŒì¼ ì €ì¥ ê²½ë¡œì— ê°€ë³´ë©´ ì‹¤ì œ íŒŒì¼ì´ ì €ì¥ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/><br/>
**ê²°ê³¼ ë¡œê·¸**
```
==== PART ====
name=itemName
header content-disposition: form-data; name="itemName"
submittedFilename=null
size=6
body=Spring
==== PART ====
name=file
header content-disposition: form-data; name="file"; filename="sign.png"
header content-type: image/png
submittedFilename=sign.png
size=6214
body=ï¿½PNG...

íŒŒì¼ ì €ì¥ fullPath=D:/study/file/sign.png
```
<br/><br/>ì„œë¸”ë¦¿ì´ ì œê³µí•˜ëŠ” `Part`ëŠ” í¸í•˜ê¸°ëŠ” í•˜ì§€ë§Œ, `HttpServletRequest`ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ê³ , ì¶”ê°€ë¡œ íŒŒì¼ ë¶€ë¶„ë§Œ êµ¬ë¶„í•˜ë ¤ë©´ ì—¬ëŸ¬ê°€ì§€ ì½”ë“œë¥¼ ë„£ì–´ì•¼ í•œë‹¤.<br/><br/>
# ğŸ” ìŠ¤í”„ë§ê³¼ íŒŒì¼ ì—…ë¡œë“œ
ìŠ¤í”„ë§ì€ `MultipartFile`ì´ë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ ë©€í‹°íŒŒíŠ¸ íŒŒì¼ì„ ë§¤ìš° í¸ë¦¬í•˜ê²Œ ì§€ì›í•œë‹¤.<br/><br/>
`java/hello/upload/controller/SpringUploadController`
```java
@Slf4j
@Controller
@RequestMapping("/spring")
public class SpringUploadController {

    @Value("${file.dir}")
    private String fileDir;

    @GetMapping("/upload")
    public String newFile() {
        return "upload-form";
    }

    @PostMapping("/upload")
    public String saveFile(@RequestParam("itemName") String itemName,
                           @RequestParam("file") MultipartFile file, HttpServletRequest request) throws IOException {
        log.info("request={}", request);
        log.info("itemName={}", itemName);
        log.info("multipartFile={}", file);

        if (!file.isEmpty()) {
            String fullPath = fileDir + file.getOriginalFilename();
            log.info("íŒŒì¼ ì €ì¥ fullPath={}", fullPath);
            file.transferTo(new File(fullPath));
        }

        return "upload-form";
    }
}
```
ì—…ë¡œë“œí•˜ëŠ” HTML Formì˜ nameì— ë§ì¶”ì–´ `@RequestParam`ì„ ì ìš©í•˜ë©´ ëœë‹¤.<br/> 
ì¶”ê°€ë¡œ `@ModelAttribute`ì—ì„œë„ `MultipartFile`ì„ ë™ì¼í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.<br/><br/>
**MultipartFile ì£¼ìš” ë©”ì„œë“œ**<br/>
`file.getOriginalFilename()`: ì—…ë¡œë“œ íŒŒì¼ ëª…<br/>
`file.transferTo(...)`: íŒŒì¼ ì €ì¥<br/><br/>
**ì‹¤í–‰**<br/>
![image](https://github.com/jang9205/spring_study/assets/123082616/90a5f234-0e6a-4e00-8349-999ab24263a4)<br/><br/>
**ì‹¤í–‰ ë¡œê·¸**
```
request=org.springframework.web.multipart.support.StandardMultipartHttpServletRequest@438808f7
itemName=itemC
multipartFile=org.springframework.web.multipart.support.StandardMultipartHttpServletRequest$StandardMultipartFile@6e69cfd4
íŒŒì¼ ì €ì¥ fullPath=D:/study/file/sign.png
```
<br/><br/>
# ğŸ” ì˜ˆì œë¡œ êµ¬í˜„í•˜ëŠ” íŒŒì¼ ì—…ë¡œë“œ, ë‹¤ìš´ë¡œë“œ
### ìš”êµ¬ì‚¬í•­
- ìƒí’ˆì„ ê´€ë¦¬
  - ìƒí’ˆ ì´ë¦„
  - ì²¨ë¶€íŒŒì¼ í•˜ë‚˜
  - ì´ë¯¸ì§€ íŒŒì¼ ì—¬ëŸ¬ê°œ
- ì²¨ë¶€íŒŒì¼ì„ ì—…ë¡œë“œ ë‹¤ìš´ë¡œë“œ í•  ìˆ˜ ìˆë‹¤.
- ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ë¥¼ ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
<br/><br/>
#### ìƒí’ˆ ë„ë©”ì¸
`java/hello/upload/domain/Item`
```java
@Data
public class Item {

    private Long id;
    private String itemName;
    private UploadFile attachFile;
    private List<UploadFile> imageFiles;
}
```
#### ì—…ë¡œë“œ íŒŒì¼ ì •ë³´ ë³´ê´€
`java/hello/upload/domain/UploadFile`
```java
@Data
public class UploadFile {

    private String uploadFileName;
    private String storeFileName;

    public UploadFile(String uploadFileName, String storeFileName) {
        this.uploadFileName = uploadFileName;
        this.storeFileName = storeFileName;
    }
}
```
`uploadFileName`: ê³ ê°ì´ ì—…ë¡œë“œí•œ íŒŒì¼ëª…<br/>
`storeFileName`: ì„œë²„ ë‚´ë¶€ì—ì„œ ê´€ë¦¬í•˜ëŠ” íŒŒì¼ëª…<br/><br/>
ê³ ê°ì´ ì—…ë¡œë“œí•œ íŒŒì¼ëª…ìœ¼ë¡œ ì„œë²„ ë‚´ë¶€ì— íŒŒì¼ì„ ì €ì¥í•˜ë©´ ì•ˆëœë‹¤.<br/>
ì™œëƒí•˜ë©´ ì„œë¡œ ë‹¤ë¥¸ ê³ ê°ì´ ê°™ì€ íŒŒì¼ì´ë¦„ì„ ì—…ë¡œë“œ í•˜ëŠ” ê²½ìš° ê¸°ì¡´ íŒŒì¼ ì´ë¦„ê³¼ ì¶©ëŒì´ ë‚  ìˆ˜ ìˆë‹¤.<br/>
ì„œë²„ì—ì„œëŠ” ì €ì¥í•  íŒŒì¼ëª…ì´ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ë‚´ë¶€ì—ì„œ ê´€ë¦¬í•˜ëŠ” ë³„ë„ì˜ íŒŒì¼ëª…ì´ í•„ìš”í•˜ë‹¤.<br/><br/>
#### ìƒí’ˆ ë¦¬í¬ì§€í† ë¦¬
`java/hello/upload/domain/ItemRepository`
```java
@Repository
public class ItemRepository {

    private final Map<Long, Item> store = new HashMap<>();
    private long sequence = 0L;

    public Item save(Item item) {
        item.setId(++sequence);
        store.put(item.getId(), item);
        return item;
    }

    public Item findById(Long id) {
        return store.get(id);
    }
}
```
#### íŒŒì¼ ì €ì¥ê³¼ ê´€ë ¨ëœ ì—…ë¬´ ì²˜ë¦¬
`java/hello/upload/file/FileStore`
```java
@Component
public class FileStore {

    @Value("${file.dir}")
    private String fileDir;

    private String getFullPath(String filename) {
        return fileDir + filename;
    }

    public List<UploadFile> storeFiles(List<MultipartFile> multipartFiles) throws IOException {
        List<UploadFile> storeFileResult = new ArrayList<>();
        for (MultipartFile multipartFile : multipartFiles) {
            if (!multipartFile.isEmpty()) {
                storeFileResult.add(storeFile(multipartFile));
            }
        }
        return storeFileResult;
    }

    public UploadFile storeFile(MultipartFile multipartFile) throws IOException {
        if (multipartFile.isEmpty()) {
            return null;
        }

        String originalFilename = multipartFile.getOriginalFilename();
        String storeFileName = createStoreFileName(originalFilename);
        multipartFile.transferTo(new File(getFullPath(storeFileName)));
        return new UploadFile(originalFilename, storeFileName);
    }

    private String createStoreFileName(String originalFilename) {
        String uuid = UUID.randomUUID().toString();
        String ext = extractExt(originalFilename);
        return uuid + "." + ext;
    }

    private String extractExt(String originalFilename) {
        int pos = originalFilename.lastIndexOf(".");
        return originalFilename.substring(pos + 1);
    }
}
```
ë©€í‹°íŒŒíŠ¸ íŒŒì¼ì„ ì„œë²„ì— ì €ì¥í•˜ëŠ” ì—­í• ì„ ë‹´ë‹¹í•œë‹¤.
- `createStoreFileName()`: ì„œë²„ ë‚´ë¶€ì—ì„œ ê´€ë¦¬í•˜ëŠ” íŒŒì¼ëª…ì€ ìœ ì¼í•œ ì´ë¦„ì„ ìƒì„±í•˜ëŠ” `UUID`ë¥¼ ì‚¬ìš©í•´ì„œ ì¶©ëŒí•˜ì§€ ì•Šë„ë¡ í•œë‹¤.
- `extractExt()`: í™•ì¥ìë¥¼ ë³„ë„ë¡œ ì¶”ì¶œí•´ì„œ ì„œë²„ ë‚´ë¶€ì—ì„œ ê´€ë¦¬í•˜ëŠ” íŒŒì¼ëª…ì—ë„ ë¶™ì—¬ì¤€ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ ê³ ê°ì´ `a.png`ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì—…ë¡œë“œ í•˜ë©´ `51041c62-86e4-4274-801d-614a7d994edb.png`ì™€ ê°™ì´ ì €ì¥í•œë‹¤.
<br/><br/>
#### ìƒí’ˆ ì €ì¥ìš© í¼
`java/hello/upload/controller/ItemForm`
```java
@Data
public class ItemForm {

    private Long itemId;
    private String itemName;
    private MultipartFile attachFile;
    private List<MultipartFile> imageFiles;
}
```
`List<MultipartFile> imageFiles`: ì´ë¯¸ì§€ë¥¼ ë‹¤ì¤‘ ì—…ë¡œë“œ í•˜ê¸° ìœ„í•´ `MultipartFile`ë¥¼ ì‚¬ìš©í–ˆë‹¤.<br/>
`MultipartFile attachFile`: ë©€í‹°íŒŒíŠ¸ëŠ” `@ModelAttribute`ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.<br/><br/>
#### ìƒí’ˆ ì»¨íŠ¸ë¡¤ëŸ¬
`java/hello/upload/controller/ItemController`
```java
@Slf4j
@Controller
@RequiredArgsConstructor
public class ItemController {

    private final ItemRepository itemRepository;
    private final FileStore fileStore;

    @GetMapping("/items/new")
    public String newItem(@ModelAttribute("form") ItemForm form) {
        return "item-form";
    }

    @PostMapping("/items/new")
    public String saveItem(@ModelAttribute("form") ItemForm form, RedirectAttributes redirectAttributes) throws IOException {
        UploadFile attachFile = fileStore.storeFile(form.getAttachFile());

        List<UploadFile> storeImageFiles = fileStore.storeFiles(form.getImageFiles());

        //ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥
        Item item = new Item();
        item.setItemName(form.getItemName());
        item.setAttachFile(attachFile);
        item.setImageFiles(storeImageFiles);
        itemRepository.save(item);

        redirectAttributes.addAttribute("itemId", item.getId());

        return "redirect:/items/{itemId}";
    }

    @GetMapping("/items/{id}")
    public String items(@PathVariable("id") Long id, Model model) {
        Item item = itemRepository.findById(id);
        model.addAttribute("item", item);
        return "item-view";
    }

    @ResponseBody
    @GetMapping("/images/{filename}")
    public Resource downloadImage(@PathVariable("filename") String filename) throws MalformedURLException {
        return new UrlResource("file:" + fileStore.getFullPath(filename));
    }

    @GetMapping("/attach/{itemId}")
    public ResponseEntity<Resource> downloadAttach(@PathVariable("itemId") Long itemId) throws MalformedURLException {
        Item item = itemRepository.findById(itemId);
        String storeFileName = item.getAttachFile().getStoreFileName();
        String uploadFileName = item.getAttachFile().getUploadFileName();

        UrlResource resource = new UrlResource("file:" + fileStore.getFullPath(storeFileName));

        log.info("uploadFileName={}", uploadFileName);

        String encodedUploadFileName = UriUtils.encode(uploadFileName, StandardCharsets.UTF_8);
        String contentDisposition = "attachment; filename=\"" + encodedUploadFileName + "\"";

        return ResponseEntity.ok()
                .header(HttpHeaders.CONTENT_DISPOSITION, contentDisposition)
                .body(resource);
    }
}
```
- `@GetMapping("/items/new")`: ë“±ë¡ í¼ì„ ë³´ì—¬ì¤€ë‹¤.
- `@PostMapping("/items/new")`: í¼ì˜ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ë³´ì—¬ì£¼ëŠ” í™”ë©´ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•œë‹¤.
- `@GetMapping("/items/{id}")`: ìƒí’ˆì„ ë³´ì—¬ì¤€ë‹¤.
- `@GetMapping("/images/{filename}")`: <img> íƒœê·¸ë¡œ ì´ë¯¸ì§€ë¥¼ ì¡°íšŒí•  ë•Œ ì‚¬ìš©í•œë‹¤. `UrlResource`ë¡œ ì´ë¯¸ì§€ íŒŒì¼ì„ ì½ì–´ì„œ `@ResponseBody`ë¡œ ì´ë¯¸ì§€ ë°”ì´ë„ˆë¦¬ë¥¼ ë°˜í™˜í•œë‹¤.
- `@GetMapping("/attach/{itemId}")`: íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ í•  ë•Œ ì‹¤í–‰í•œë‹¤. ì˜ˆì œë¥¼ ë” ë‹¨ìˆœí™” í•  ìˆ˜ ìˆì§€ë§Œ, íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹œ ê¶Œí•œ ì²´í¬ê°™ì€ ë³µì¡í•œ ìƒí™©ê¹Œì§€ ê°€ì •í•œë‹¤ ìƒê°í•˜ê³  ì´ë¯¸ì§€ `id`ë¥¼ ìš”ì²­í•˜ë„ë¡ í–ˆë‹¤. íŒŒì¼ ë‹¤ìš´ë¡œë“œì‹œì—ëŠ” ê³ ê°ì´ ì—…ë¡œë“œí•œ íŒŒì¼ ì´ë¦„ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ í•˜ëŠ”ê²Œ ì¢‹ë‹¤. ì´ë•ŒëŠ” `Content-Disposition` í—¤ë”ì— `attachment; filename="ì—…ë¡œë“œ íŒŒì¼ëª…"` ê°’ì„ ì£¼ë©´ ëœë‹¤.
<br/><br/>
#### ë“±ë¡ í¼ ë·°
`resources/templates/item-form.html`
```html
...
<div class="container">

    <div class="py-5 text-center">
        <h2>ìƒí’ˆ ë“±ë¡</h2>
    </div>

    <form th:action method="post" enctype="multipart/form-data">
        <ul>
            <li>ìƒí’ˆëª… <input type="text" name="itemName"></li>
            <li>ì²¨ë¶€íŒŒì¼<input type="file" name="attachFile" ></li>
            <li>ì´ë¯¸ì§€ íŒŒì¼ë“¤<input type="file" multiple="multiple" name="imageFiles" ></li>
        </ul>
        <input type="submit"/>
    </form>

</div> <!-- /container -->
...
```
ë‹¤ì¤‘ íŒŒì¼ ì—…ë¡œë“œë¥¼ í•˜ë ¤ë©´ `multiple="multiple"` ì˜µì…˜ì„ ì£¼ë©´ ëœë‹¤.<br/>
`ItemForm`ì˜ `private List<MultipartFile> imageFiles;`ì—ì„œ ì—¬ëŸ¬ ì´ë¯¸ì§€ íŒŒì¼ì„ ë°›ì„ ìˆ˜ ìˆë‹¤.<br/><br/>
#### ì¡°íšŒ ë·°
`resources/templates/item-view.html`
```html
...
<div class="container">

    <div class="py-5 text-center">
        <h2>ìƒí’ˆ ì¡°íšŒ</h2>
    </div>

    ìƒí’ˆëª…: <span th:text="${item.itemName}">ìƒí’ˆëª…</span><br/>
    ì²¨ë¶€íŒŒì¼: <a th:if="${item.attachFile}" th:href="|/attach/${item.id}|" th:text="${item.getAttachFile().getUploadFileName()}" /><br/>
    <img th:each="imageFile : ${item.imageFiles}" th:src="|/images/${imageFile.getStoreFileName()}|" width="300" height="300"/>

</div> <!-- /container -->
...
```
ì²¨ë¶€ íŒŒì¼ì€ ë§í¬ë¡œ ê±¸ì–´ë‘ê³ , ì´ë¯¸ì§€ëŠ” `<img>` íƒœê·¸ë¥¼ ë°˜ë³µí•´ì„œ ì¶œë ¥í•œë‹¤.<br/><br/>
ì‹¤í–‰í•´ë³´ë©´ í•˜ë‚˜ì˜ ì²¨ë¶€íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ ì—…ë¡œë“œ í•˜ê³ , ì—¬ëŸ¬ ì´ë¯¸ì§€ íŒŒì¼ì„ í•œë²ˆì— ì—…ë¡œë“œ í•  ìˆ˜ ìˆë‹¤.